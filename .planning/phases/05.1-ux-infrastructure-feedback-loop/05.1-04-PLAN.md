---
phase: 05.1-ux-infrastructure-feedback-loop
plan: 04
type: execute
wave: 3
depends_on: ["05.1-02", "05.1-03"]
files_modified:
  - .planning/ux-critique-protocol.md
  - .planning/coffee-token-mapping.md
  - .planning/critiques/.gitkeep
autonomous: true

must_haves:
  truths:
    - "UX critique protocol is documented with trigger conditions, process steps, and output format"
    - "Coffee token mapping document shows every old-to-new color replacement"
    - "Protocol explicitly forbids proposing solutions (observations and questions only)"
    - "Critiques directory exists for future critique documents"
  artifacts:
    - path: ".planning/ux-critique-protocol.md"
      provides: "Complete UX critique protocol definition"
      contains: "Observations"
    - path: ".planning/coffee-token-mapping.md"
      provides: "Token inheritance and override documentation"
      contains: "Espresso"
    - path: ".planning/critiques/.gitkeep"
      provides: "Critiques directory ready for Phase 6 use"
  key_links:
    - from: ".planning/ux-critique-protocol.md"
      to: "agent-browser"
      via: "Protocol references ab snapshot command"
      pattern: "ab snapshot"
    - from: ".planning/ux-critique-protocol.md"
      to: "ChunkHound"
      via: "Protocol references chunkhound for token checks"
      pattern: "chunkhound"
---

<objective>
Document the UX critique protocol and Coffee token mapping so that Phase 6 has a clear, enforceable process for UI changes.

Purpose: This is the governance layer of the UX infrastructure. Without documentation, the tools installed in Plan 03 have no defined workflow, and the theme applied in Plans 01-02 has no reference document. Phase 6 work is gated on this protocol existing.
Output: UX critique protocol document, Coffee token mapping document, critiques directory for future use.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05.1-ux-infrastructure-feedback-loop/05.1-CONTEXT.md
@.planning/phases/05.1-ux-infrastructure-feedback-loop/05.1-RESEARCH.md
@.planning/phases/05.1-ux-infrastructure-feedback-loop/05.1-01-SUMMARY.md
@.planning/phases/05.1-ux-infrastructure-feedback-loop/05.1-02-SUMMARY.md
@.planning/phases/05.1-ux-infrastructure-feedback-loop/05.1-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write UX critique protocol document</name>
  <files>.planning/ux-critique-protocol.md</files>
  <action>
Create `.planning/ux-critique-protocol.md` with the complete UX critique protocol. This document defines the mandatory review process for all UI/UX changes starting in Phase 6.

Document structure:

```markdown
# UX Critique Protocol

## Purpose

Mandatory review process for ALL UI code changes. Ensures Coffee design system compliance and deliberate visual decisions. This protocol is a prerequisite for Phase 6 and all subsequent UI work.

## When to Trigger

**Mandatory before ANY commit that modifies:**
- Files in `components/` (any .tsx file)
- `app/page.tsx` or `app/layout.tsx`
- `app/globals.css`
- Any file containing Tailwind classes

**Exceptions (no critique needed):**
- Pure logic changes (lib/, contexts/ that don't touch UI)
- Test files
- Documentation files
- Configuration files (unless they affect visual output)

## Process

### Step 1: Capture Current State
```bash
# Start dev server if not running
npm run dev

# Open the app in agent-browser
ab open http://localhost:3000

# Take accessibility snapshot (text-based, for AI analysis)
ab snapshot > /tmp/critique-before.txt

# Take screenshot for visual reference
ab screenshot --path /tmp/critique-before.png
```

### Step 2: Identify Affected Components
```bash
# Use ChunkHound to find related components
chunkhound search "components affected by [change description]"

# Check what the changed component renders
chunkhound research "[component name] dependencies and consumers"
```

### Step 3: Write Critique Document

Create `.planning/critiques/YYYY-MM-DD-{view-or-component}.md` using the template below.

### Step 4: Capture Post-Change State
After implementing changes:
```bash
ab open http://localhost:3000
ab snapshot > /tmp/critique-after.txt
ab screenshot --path /tmp/critique-after.png
```

### Step 5: Verify Token Compliance
```bash
# Check for any hardcoded default Tailwind colors in changed files
grep -rn "bg-(red|blue|yellow|gray|green|purple)-[0-9]" [changed files]
```
Must return zero matches.

## Critique Document Template

```markdown
# UX Critique: {View or Component Name}

**Date:** YYYY-MM-DD
**Triggered by:** {what UI change is proposed or implemented}
**Scope:** {which components/views are affected}

## Visual Capture
- Before: /tmp/critique-before.png
- After: /tmp/critique-after.png (if post-implementation)
- Snapshot: /tmp/critique-before.txt

## Observations
1. {Factual observation about current state - no judgment, no solutions}
2. {Another observation}
3. {Pattern noticed}

## Questions
1. {Does X alignment match the 4px spacing grid?}
2. {Is this color consistent with its semantic meaning across other components?}
3. {Does the touch target meet 44px minimum?}

## Design System Violations
| Element | Current Value | Expected (Coffee Token) | Severity |
|---------|--------------|------------------------|----------|
| {element} | {what it currently uses} | {correct Coffee token} | high/medium/low |

## Token Compliance
- Colors: {PASS/FAIL - list violations if any}
- Typography: {PASS/FAIL - all text using Nunito?}
- Spacing: {PASS/FAIL - consistent with 4px base?}
- Border Radius: {PASS/FAIL - using sm/md/lg/xl tokens?}
- Shadows: {PASS/FAIL - espresso-based rgba?}
```

## Rules

### ALLOWED in critique output:
- State factual observations ("The button background is #2563eb")
- Ask clarifying questions ("Should the hover state darken or lighten?")
- Flag design system violations (table with current vs expected)
- Note accessibility concerns ("Contrast ratio appears low")
- Reference Coffee token names ("Expected: bg-caramel")

### FORBIDDEN in critique output:
- Propose code changes ("Change bg-blue-500 to bg-caramel")
- Suggest implementations ("Wrap in a div with padding")
- Recommend alternatives ("Use a modal instead of a dropdown")
- Make design decisions ("This should be left-aligned")
- Provide solutions of any kind

The critique exists to INFORM, not to PRESCRIBE. The developer (human or Claude executor) reviews the critique and decides how to act on it.

## Coffee Design System Reference

### Colors
| Token | Hex | Tailwind Class | Use For |
|-------|-----|----------------|---------|
| Espresso | #2C1810 | bg-espresso, text-espresso | Primary text, dark backgrounds, tooltips |
| Dark Roast | #3D251E | bg-dark-roast, text-dark-roast | Hover states on dark elements |
| Mocha | #5D3A2E | bg-mocha, text-mocha | Links, secondary emphasis |
| Coffee | #6F4E37 | bg-coffee, text-coffee | Secondary text, labels |
| Cappuccino | #8B6B5D | bg-cappuccino, text-cappuccino | Muted text, cancel buttons |
| Latte | #C4A484 | bg-latte, text-latte | Borders, dividers |
| Oat Milk | #D4C4A8 | bg-oat-milk | Disabled states, subtle backgrounds |
| Cream | #F5F0E8 | bg-cream | Weekend cells, hover backgrounds |
| Foam | #FAF8F5 | bg-foam | Page background, light cards |

### Accents
| Token | Hex | Tailwind Class | Semantic Use |
|-------|-----|----------------|-------------|
| Caramel | #C68E17 | bg-caramel, text-caramel | Vacation days, primary actions, today ring |
| Cinnamon | #B5651D | bg-cinnamon, text-cinnamon | Holidays |
| Honey | #EB9605 | bg-honey, text-honey | Bridge days |

### Semantic
| Token | Hex | Use For |
|-------|-----|---------|
| Success | #5D8A4E | Positive remaining days |
| Warning | #C68E17 | Same as Caramel (intentional) |
| Error | #B54D4D | Negative values, validation errors |
| Info | #5D7A8A | Informational messages |

### Typography
- Primary: Nunito (latin + cyrillic subsets)
- Weights: 400 (body), 600 (semibold labels), 700 (bold headings)
- Accent: Caveat (cursive, for decorative text if needed)

### Spacing
- Base unit: 4px
- Scale: xs(4px) sm(8px) md(16px) lg(24px) xl(32px) 2xl(48px) 3xl(64px) 4xl(96px)

### Border Radius
- sm: 8px, md: 12px, lg: 16px, xl: 24px
```

This document is the AUTHORITATIVE reference for the UX critique process. It will be referenced by all Phase 6 planning and execution.
  </action>
  <verify>
- File exists at .planning/ux-critique-protocol.md
- Contains all required sections: Purpose, When to Trigger, Process (5 steps), Template, Rules (Allowed/Forbidden), Coffee Design System Reference
- Rules section explicitly lists FORBIDDEN items (no solutions)
- Token reference table includes all 9 base colors, 3 accents, 4 semantic colors
  </verify>
  <done>
UX critique protocol document created with complete process definition, critique template, strict "no solutions" rules, and full Coffee design system reference table. Ready for Phase 6 enforcement.
  </done>
</task>

<task type="auto">
  <name>Task 2: Write Coffee token mapping document and create critiques directory</name>
  <files>
    .planning/coffee-token-mapping.md
    .planning/critiques/.gitkeep
  </files>
  <action>
1. Create `.planning/critiques/` directory with a `.gitkeep` file (empty file to ensure git tracks the directory):
   ```bash
   mkdir -p .planning/critiques
   touch .planning/critiques/.gitkeep
   ```

2. Create `.planning/coffee-token-mapping.md` documenting every color replacement made in Plans 01-02. This serves as a reference for what was changed and why.

Document structure:

```markdown
# Coffee Theme Token Mapping

**Applied:** Phase 5.1, Plans 01-02
**Reference:** https://ggprompts.github.io/htmlstyleguides/styles/coffee.html

## Token Source

All tokens defined in `app/globals.css` via Tailwind v4 `@theme` block.
Utility classes auto-generated by Tailwind (e.g., `--color-espresso` -> `bg-espresso`, `text-espresso`).

## Font Replacement

| Before | After | Notes |
|--------|-------|-------|
| Geist (latin only) | Nunito (latin + cyrillic) | Cyrillic subset critical for Bulgarian UI |
| --font-geist-sans | --font-nunito | CSS variable renamed |
| Arial, Helvetica fallback | Nunito, ui-sans-serif, system-ui fallback | Body font-family |

## Color Replacements by Component

### MonthGrid.tsx (Calendar Day Cells)

| Element | Before | After | Token |
|---------|--------|-------|-------|
| Today ring | ring-blue-500 | ring-today-ring | Caramel #C68E17 |
| Highlight flash | bg-gray-200 | bg-highlight | Oat Milk #D4C4A8 |
| Holiday cell | bg-red-100 text-red-900 | bg-holiday-bg text-holiday | Cinnamon tint / Cinnamon |
| Bridge cell | bg-yellow-100 text-yellow-900 | bg-bridge-bg text-bridge | Honey tint / Honey |
| Vacation cell | bg-blue-100 text-blue-900 | bg-vacation-bg text-vacation | Caramel tint / Caramel |
| Weekend cell | bg-gray-50 text-gray-500 | bg-weekend-bg text-weekend-text | Cream / Cappuccino |
| Workday hover | hover:bg-gray-100 | hover:bg-cream | Cream |
| Card border | border-gray-200 | border-latte | Latte #C4A484 |
| Day headers | text-gray-600 | text-coffee | Coffee #6F4E37 |

### Legend.tsx

| Element | Before | After | Token |
|---------|--------|-------|-------|
| Holiday block | bg-red-500 | bg-cinnamon | Cinnamon #B5651D |
| Weekend block | bg-gray-100 border | bg-cream border-latte | Cream / Latte |
| Today block | border-blue-500 | border-caramel | Caramel #C68E17 |
| Vacation block | bg-blue-100 border-gray-300 | bg-vacation-bg border-latte | Caramel tint / Latte |

### DayTooltip.tsx

| Element | Before | After | Token |
|---------|--------|-------|-------|
| Info button | bg-white text-gray-800 | bg-foam text-espresso | Foam / Espresso |
| Info hover | hover:bg-gray-100 | hover:bg-cream | Cream |
| Tooltip bg | bg-gray-900 | bg-espresso | Espresso #2C1810 |
| Tooltip text | text-white | text-foam | Foam #FAF8F5 |

### VacationSummary.tsx

| Element | Before | After | Token |
|---------|--------|-------|-------|
| Container | bg-white border-gray-200 | bg-white border-latte | Latte |
| Title | text-gray-800 | text-espresso | Espresso |
| Labels | text-gray-600 | text-coffee | Coffee |
| Values | text-gray-800 | text-espresso | Espresso |
| Save button | bg-green-500 | bg-caramel | Caramel |
| Cancel button | bg-gray-400 | bg-cappuccino | Cappuccino |
| Edit link | text-blue-600 | text-mocha | Mocha |
| Rollover text | text-purple-600 | text-mocha | Mocha |
| Positive | text-green-600 | text-success | Success #5D8A4E |
| Negative | text-red-600 | text-error | Error #B54D4D |
| Divider | border-gray-200 | border-latte | Latte |
| Percentage | text-gray-500 | text-cappuccino | Cappuccino |

### AuthHeader.tsx

| Element | Before | After | Token |
|---------|--------|-------|-------|
| Skeleton | bg-gray-200 | bg-oat-milk | Oat Milk |
| Button text | text-gray-700 | text-coffee | Coffee |
| Button border | border-gray-300 | border-latte | Latte |
| Button hover | hover:bg-gray-50 | hover:bg-cream | Cream |

### UserMenu.tsx

| Element | Before | After | Token |
|---------|--------|-------|-------|
| Name text | text-gray-700 | text-coffee | Coffee |
| Dropdown bg | bg-white border-gray-200 | bg-white border-latte | Latte |
| Menu item | text-gray-700 hover:bg-gray-100 | text-coffee hover:bg-cream | Coffee / Cream |

### MigrationReview.tsx

| Element | Before | After | Token |
|---------|--------|-------|-------|
| Description | text-gray-700 | text-coffee | Coffee |
| Data rows | bg-gray-50 text-gray-600 | bg-cream text-coffee | Cream / Coffee |
| Merged row | bg-blue-50 text-blue-600 | bg-vacation-bg text-vacation | Caramel tint / Caramel |
| Keep button | border-gray-300 hover:bg-gray-50 | border-latte hover:bg-cream | Latte / Cream |
| Merge button | bg-blue-600 | bg-caramel | Caramel |

### app/page.tsx

| Element | Before | After | Token |
|---------|--------|-------|-------|
| Subtitle | text-gray-600 | text-coffee | Coffee |

### public/manifest.json

| Property | Before | After |
|----------|--------|-------|
| background_color | #ffffff | #FAF8F5 (Foam) |
| theme_color | #2563eb | #C68E17 (Caramel) |

### app/layout.tsx

| Property | Before | After |
|----------|--------|-------|
| themeColor | #2563eb | #C68E17 (Caramel) |

## Semantic Aliases

These aliases map domain concepts to Coffee tokens, defined in globals.css @theme:

| Alias | Maps To | Hex |
|-------|---------|-----|
| --color-holiday | Cinnamon | #B5651D |
| --color-holiday-bg | Light Cinnamon tint | #F5E6D8 |
| --color-bridge | Honey | #EB9605 |
| --color-bridge-bg | Light Honey tint | #FDF3DC |
| --color-vacation | Caramel | #C68E17 |
| --color-vacation-bg | Light Caramel tint | #F9EED4 |
| --color-weekend-bg | Cream | #F5F0E8 |
| --color-weekend-text | Cappuccino | #8B6B5D |
| --color-today-ring | Caramel | #C68E17 |
| --color-highlight | Oat Milk | #D4C4A8 |

## Inherited vs Overridden

**Inherited from Coffee (used as-is):**
- All 9 base colors (Espresso through Foam)
- All 3 accent colors (Caramel, Cinnamon, Honey)
- Nunito font family
- 4px spacing base unit
- Border radius scale (8/12/16/24px)

**Overridden/Extended (project-specific):**
- Semantic calendar aliases (holiday, bridge, vacation mappings)
- Light tint backgrounds for calendar cells (not in Coffee spec, derived from accent colors)
- Success/Warning/Error/Info semantic colors (adopted from Coffee)
- Rollover text color changed from purple to Mocha (Coffee has no purple)

**Removed:**
- Dark mode (Coffee doesn't define it, project doesn't require it)
- Geist fonts (replaced by Nunito)
- All default Tailwind color utilities (replaced by Coffee tokens)
```
  </action>
  <verify>
- File exists at .planning/coffee-token-mapping.md
- Contains mapping tables for ALL components modified in Plan 02
- Contains Semantic Aliases section
- Contains Inherited vs Overridden section
- Directory .planning/critiques/ exists with .gitkeep
  </verify>
  <done>
Coffee token mapping document created with complete old-to-new replacement tables for every component. Critiques directory created and ready for Phase 6. Inherited vs overridden tokens clearly documented.
  </done>
</task>

</tasks>

<verification>
1. .planning/ux-critique-protocol.md exists with complete protocol (trigger, process, template, rules, reference)
2. .planning/coffee-token-mapping.md exists with all component color mappings
3. .planning/critiques/ directory exists (with .gitkeep)
4. Protocol explicitly states no solutions in critique output
5. Token mapping covers all components modified in Plan 02
</verification>

<success_criteria>
- UX critique protocol fully documented and enforceable for Phase 6
- Coffee token mapping serves as authoritative reference for all color decisions
- Critiques directory ready for future critique documents
- All Phase 5.1 success criteria can be verified against these documents
</success_criteria>

<output>
After completion, create `.planning/phases/05.1-ux-infrastructure-feedback-loop/05.1-04-SUMMARY.md`
</output>
