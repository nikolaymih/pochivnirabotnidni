# Summary: Plan 01.1 - Fix Holiday Date Timezone Bug

**Executed:** 2026-01-25
**Duration:** ~15 minutes
**Status:** ✅ Complete

## What Was Built

Fixed critical timezone conversion bug that caused January 1st holidays (New Year's Day) to appear on December 31st of the previous year.

## The Bug

User reported December 31st, 2026 showing as "Нова година" (New Year) official holiday when it shouldn't be. Investigation revealed:

1. OpenHolidays API correctly returned `"startDate": "2027-01-01"` for New Year's Day 2027
2. Code converted this to UTC: `parseISO("2027-01-01").toISOString()` → `"2026-12-31T22:00:00.000Z"`
3. Date extraction got wrong day: `split('T')[0]` → `"2026-12-31"`

## The Fix

**Changed:** `lib/holidays/fetch.ts:24`
```typescript
// Before (buggy):
date: parseISO(h.startDate).toISOString().split('T')[0]

// After (correct):
date: h.startDate // API already returns YYYY-MM-DD format
```

**Added:** Enhanced debugging logs
- Raw API response logging
- Processed holidays detailed output
- Specific December 31st check
- Better error handling with try-catch for fallback

**Removed:** Unnecessary `parseISO` import

## Verification

✅ December 31st, 2026 no longer shows as holiday
✅ Browser console confirms correct date processing
✅ No timezone conversion applied to date-only values
✅ Logging helps catch similar issues in future

## Key Takeaway

**Never use `toISOString()` for date-only values.** Timezone conversion is inappropriate when working with calendar dates (YYYY-MM-DD). Use API-provided date strings directly when they're already in the correct format.

## Files Changed

- `lib/holidays/fetch.ts` - Fixed date parsing, enhanced logging

## Impact

- **User Impact:** Critical bug fixed - holidays now show on correct dates
- **Performance:** Slight improvement (removed unnecessary parsing)
- **Code Quality:** Better logging for future debugging
- **Technical Debt:** Reinforced TECH-07 decision (ISO date strings without time)
