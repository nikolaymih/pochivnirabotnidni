---
phase: 02-anonymous-vacation-tracking
plan: 02
type: execute
wave: 2
depends_on: [02-01]
files_modified:
  - components/VacationSummary.tsx
  - components/CalendarDay.tsx
  - components/Legend.tsx
  - app/page.tsx
autonomous: false

must_haves:
  truths:
    - User can see their total vacation days allowance
    - User can see how many vacation days they have used
    - User can see how many vacation days remain
    - User can edit their annual vacation allowance
    - Vacation days display in light blue color on calendar
    - Legend shows vacation day color and label
  artifacts:
    - path: components/VacationSummary.tsx
      provides: Vacation balance display with inline editing
      exports: [default]
      min_lines: 80
      contains: "totalDays"
    - path: components/CalendarDay.tsx
      provides: Blue background styling for vacation days
      contains: "isVacation"
    - path: components/Legend.tsx
      provides: Vacation legend item with Bulgarian label
      contains: "–õ–∏—á–Ω–∞ –ø–æ—á–∏–≤–∫–∞"
  key_links:
    - from: components/VacationSummary.tsx
      to: hooks/useLocalStorage
      via: "import and access vacation data"
      pattern: "useLocalStorage.*vacationData"
    - from: components/VacationSummary.tsx
      to: lib/vacation/types
      via: "VacationData type import"
      pattern: "import.*VacationData"
    - from: app/page.tsx
      to: components/VacationSummary
      via: "Renders VacationSummary below Legend"
      pattern: "<VacationSummary"
---

<objective>
Create vacation summary display with inline editing and visual integration into calendar and legend.

Purpose: Users can see their vacation balance (total, used, remaining), edit their allowance, and visually identify vacation days on the calendar. Completes Phase 2 anonymous vacation tracking with full Bulgarian localization.

Output: Complete vacation tracking UI with balance panel, blue vacation day styling, and updated legend.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/02-anonymous-vacation-tracking/02-CONTEXT.md
@.planning/phases/02-anonymous-vacation-tracking/02-RESEARCH.md

# Completed work from Plan 01
@.planning/phases/02-anonymous-vacation-tracking/02-01-SUMMARY.md

# Existing components to extend
@components/Legend.tsx
@components/CalendarDay.tsx
@app/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Create VacationSummary component with inline editing</name>
  <files>components/VacationSummary.tsx</files>
  <action>
Create `components/VacationSummary.tsx` as Client Component:

```typescript
'use client';

import { useState, useEffect } from 'react';
import { useLocalStorage } from '@/hooks/useLocalStorage';
import { VacationData } from '@/lib/vacation/types';
import { VACATION_STORAGE_KEY, DEFAULT_VACATION_DATA } from '@/lib/vacation/storage';

export default function VacationSummary() {
  const [isClient, setIsClient] = useState(false);
  const [isEditing, setIsEditing] = useState(false);
  const [editValue, setEditValue] = useState(0);
  const [vacationData, setVacationData] = useLocalStorage<VacationData>(
    VACATION_STORAGE_KEY,
    DEFAULT_VACATION_DATA
  );

  useEffect(() => {
    setIsClient(true);
  }, []);

  const usedDays = vacationData.vacationDates.length;
  const remainingDays = vacationData.totalDays - usedDays;
  const percentageUsed = vacationData.totalDays > 0
    ? Math.round((usedDays / vacationData.totalDays) * 100)
    : 0;

  const handleEdit = () => {
    setEditValue(vacationData.totalDays);
    setIsEditing(true);
  };

  const handleSave = () => {
    if (editValue > 0) {
      setVacationData({
        ...vacationData,
        totalDays: editValue
      });
      setIsEditing(false);
    }
  };

  const handleCancel = () => {
    setEditValue(vacationData.totalDays);
    setIsEditing(false);
  };

  if (!isClient) {
    return <div className="mt-6 p-4 bg-white rounded-lg border border-gray-200">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</div>;
  }

  return (
    <div className="mt-6 p-4 bg-white rounded-lg border border-gray-200 space-y-3">
      <h2 className="text-lg font-semibold text-gray-800 mb-3">–õ–∏—á–Ω–∞ –ü–æ—á–∏–≤–∫–∞</h2>

      {/* Total Days (Editable) */}
      <div className="flex items-center justify-between">
        <span className="text-sm text-gray-600">üìÖ –û–±—â–æ –¥–Ω–∏ –∑–∞ –æ—Ç–ø—É—Å–∫:</span>
        {isEditing ? (
          <div className="flex items-center gap-2">
            <input
              type="number"
              value={editValue}
              onChange={(e) => setEditValue(parseInt(e.target.value) || 0)}
              className="w-20 px-2 py-1 border border-blue-400 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              min="1"
              autoFocus
            />
            <button
              onClick={handleSave}
              className="px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600"
              aria-label="–ó–∞–ø–∞–∑–∏"
            >
              ‚úì
            </button>
            <button
              onClick={handleCancel}
              className="px-2 py-1 bg-gray-400 text-white text-xs rounded hover:bg-gray-500"
              aria-label="–û—Ç–∫–∞–∑"
            >
              ‚úï
            </button>
          </div>
        ) : (
          <div className="flex items-center gap-2">
            <span className="font-semibold text-gray-800">{vacationData.totalDays}</span>
            <button
              onClick={handleEdit}
              className="text-blue-600 hover:text-blue-800 text-sm"
              aria-label="–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π –≥–æ–¥–∏—à–Ω–∞ –ø–æ—á–∏–≤–∫–∞"
            >
              ‚úèÔ∏è
            </button>
          </div>
        )}
      </div>

      {/* Used Days */}
      <div className="flex items-center justify-between">
        <span className="text-sm text-gray-600">‚úîÔ∏è –ò–∑–ø–æ–ª–∑–≤–∞–Ω–∏ –¥–Ω–∏:</span>
        <span className="font-semibold text-gray-800">{usedDays}</span>
      </div>

      {/* Remaining Days */}
      <div className="flex items-center justify-between">
        <span className="text-sm text-gray-600">‚è≥ –û—Å—Ç–∞–≤–∞—Ç –¥–Ω–∏:</span>
        <span className={`font-semibold ${remainingDays < 0 ? 'text-red-600' : 'text-green-600'}`}>
          {remainingDays}
        </span>
      </div>

      {/* Percentage Used */}
      <div className="pt-2 border-t border-gray-200">
        <span className="text-sm text-gray-500">{percentageUsed}% –∏–∑–ø–æ–ª–∑–≤–∞–Ω–∏</span>
      </div>
    </div>
  );
}
```

IMPORTANT:
- Follow Research.md Pattern 3 (inline editing with save/cancel)
- Use SSR guard pattern (`isClient` state with useEffect) to prevent hydration mismatch
- Bulgarian labels per INTL-01/INTL-02 requirements (all text in Cyrillic)
- Icons (üìÖ ‚úîÔ∏è ‚è≥ ‚úèÔ∏è) per CONTEXT.md decision "mix of icons and Bulgarian text labels"
- Text percentage format per CONTEXT.md ("60% –∏–∑–ø–æ–ª–∑–≤–∞–Ω–∏")
- No warnings for exceeding allowance per CONTEXT.md ("just display the numbers")
- Negative remaining days shown in red (user can exceed allowance)
- Allow any positive number per CONTEXT.md ("no min/max limits")
  </action>
  <verify>
```bash
# Component exists and is Client Component
head -5 components/VacationSummary.tsx | grep "'use client'"

# Has Bulgarian labels
grep "–õ–∏—á–Ω–∞ –ü–æ—á–∏–≤–∫–∞" components/VacationSummary.tsx
grep "–û–±—â–æ –¥–Ω–∏ –∑–∞ –æ—Ç–ø—É—Å–∫" components/VacationSummary.tsx
grep "–ò–∑–ø–æ–ª–∑–≤–∞–Ω–∏ –¥–Ω–∏" components/VacationSummary.tsx

# Has inline editing
grep "isEditing" components/VacationSummary.tsx
grep "handleSave" components/VacationSummary.tsx

# Has SSR guard
grep "isClient" components/VacationSummary.tsx

# No TypeScript errors
npx tsc --noEmit
```
  </verify>
  <done>
VacationSummary component created with Bulgarian labels, inline editing pattern (edit icon ‚Üí accept/cancel buttons), SSR guard for hydration safety, and percentage display. Shows total, used, remaining days.
  </done>
</task>

<task type="auto">
  <name>Add vacation styling and legend integration</name>
  <files>
    components/CalendarDay.tsx
    components/Legend.tsx
    app/page.tsx
  </files>
  <action>
Update `components/CalendarDay.tsx`:
- Find the className string for the day cell div
- Add conditional class for vacation days: `${isVacation ? 'bg-blue-100' : ''}`
- Vacation styling BEFORE holiday styling (so holidays win per CONTEXT.md: "If day is both holiday AND vacation, holiday wins (stay red)")
- Light blue per CONTEXT.md decision: "Full light blue background (similar to how holidays have red)"
- Ensure vacation style doesn't override holiday red or weekend styling

Example className logic order:
```typescript
const baseClasses = 'p-3 text-center border rounded cursor-pointer select-none';
const vacationClass = isVacation && !isHoliday ? 'bg-blue-100' : '';
const holidayClass = isHoliday ? 'bg-red-100 font-semibold' : '';
const weekendClass = isWeekend && !isHoliday ? 'bg-gray-50' : '';
const todayClass = isToday ? 'ring-2 ring-blue-500' : '';

className={`${baseClasses} ${vacationClass} ${holidayClass} ${weekendClass} ${todayClass}`}
```

Update `components/Legend.tsx`:
- Add vacation legend item AFTER "–î–Ω–µ—Å" (today) item
- Use light blue color box matching CalendarDay (bg-blue-100)
- Bulgarian label: "–õ–∏—á–Ω–∞ –ø–æ—á–∏–≤–∫–∞" per CONTEXT.md

Add to legend items array:
```tsx
<div className="flex items-center gap-2">
  <div className="w-6 h-6 bg-blue-100 border border-gray-300 rounded"></div>
  <span className="text-sm text-gray-700">–õ–∏—á–Ω–∞ –ø–æ—á–∏–≤–∫–∞</span>
</div>
```

Update `app/page.tsx`:
- Import VacationSummary: `import VacationSummary from '@/components/VacationSummary'`
- Add VacationSummary below Legend in the right sidebar
- Structure: Legend first, then VacationSummary (per CONTEXT.md "below the existing legend on the right side")

IMPORTANT:
- Use `bg-blue-100` (light blue) per Tailwind convention and CONTEXT.md
- Holiday styling takes precedence over vacation styling (both marked ‚Üí show red)
- Bulgarian text: "–õ–∏—á–Ω–∞ –ø–æ—á–∏–≤–∫–∞" (Personal vacation) per INTL-01/INTL-02
  </action>
  <verify>
```bash
# CalendarDay has vacation styling
grep "bg-blue-100" components/CalendarDay.tsx

# Legend has vacation item
grep "–õ–∏—á–Ω–∞ –ø–æ—á–∏–≤–∫–∞" components/Legend.tsx
grep "bg-blue-100" components/Legend.tsx

# Page imports and renders VacationSummary
grep "VacationSummary" app/page.tsx

# No TypeScript errors
npx tsc --noEmit
```
  </verify>
  <done>
CalendarDay applies light blue background to vacation days (holiday wins if both). Legend shows "–õ–∏—á–Ω–∞ –ø–æ—á–∏–≤–∫–∞" with blue color box. VacationSummary rendered on main page below Legend. VAC-01, VAC-05 visual requirements satisfied.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete anonymous vacation tracking system with:
- Click/drag to mark vacation days
- Light blue vacation day styling
- Vacation summary panel with total/used/remaining days
- Inline editing of annual allowance
- localStorage persistence
- Updated legend with vacation color
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Visit http://localhost:3000

**Test vacation marking:**
3. Click a calendar day ‚Üí should turn light blue (vacation marked)
4. Click the same day again ‚Üí should return to normal (vacation unmarked)
5. Click and drag across 3-5 days ‚Üí all should turn light blue
6. Try marking a holiday (red day) ‚Üí should stay red but count toward vacation balance

**Test vacation summary:**
7. Check right sidebar below legend ‚Üí should see "–õ–∏—á–Ω–∞ –ü–æ—á–∏–≤–∫–∞" panel
8. Should show: "–û–±—â–æ –¥–Ω–∏ –∑–∞ –æ—Ç–ø—É—Å–∫: 20" (default Bulgarian standard)
9. Should show: "–ò–∑–ø–æ–ª–∑–≤–∞–Ω–∏ –¥–Ω–∏: [count]" matching number of blue days
10. Should show: "–û—Å—Ç–∞–≤–∞—Ç –¥–Ω–∏: [remaining]" (20 - used)
11. Should show percentage: "[X]% –∏–∑–ø–æ–ª–∑–≤–∞–Ω–∏"

**Test inline editing:**
12. Click edit icon (‚úèÔ∏è) next to total days
13. Input field should appear with current value
14. Change value to 25, click ‚úì (green checkmark)
15. Total should update to 25, remaining should recalculate
16. Click edit icon again, change value, click ‚úï (red X)
17. Should cancel and revert to previous value (25)

**Test persistence:**
18. Mark several vacation days (5-7 days)
19. Note the used/remaining counts
20. Refresh the page (F5 or Cmd+R)
21. All blue vacation marks should persist
22. Vacation summary should show same counts

**Test legend:**
23. Check legend ‚Üí should have 4 items: –û—Ñ–∏—Ü–∏–∞–ª–µ–Ω –ø—Ä–∞–∑–Ω–∏–∫ (red), –£–∏–∫–µ–Ω–¥ (gray), –î–Ω–µ—Å (blue ring), –õ–∏—á–Ω–∞ –ø–æ—á–∏–≤–∫–∞ (light blue)

**Test validation:**
24. Mark 25+ vacation days (exceeding default 20)
25. Remaining days should show negative number in RED
26. No error messages or warnings (per CONTEXT.md)

**Browser DevTools check:**
27. Open DevTools ‚Üí Application ‚Üí Local Storage ‚Üí localhost:3000
28. Find key: `pochivni-vacation-data`
29. Value should be JSON: `{version: 1, totalDays: [N], vacationDates: ["2026-MM-DD", ...]}`
30. Dates array should match blue calendar days

**Requirements verification:**
- ‚úÖ VAC-01: Can mark dates as vacation (blue color)
- ‚úÖ VAC-02: Can enter annual allowance (inline edit)
- ‚úÖ VAC-03: Displays remaining balance (auto-calculated)
- ‚úÖ VAC-04: Shows summary (total, used, remaining)
- ‚úÖ VAC-05: Can update balance manually (edit icon)
- ‚úÖ VAC-06: Uses date-fns (inherited from Phase 1)
- ‚úÖ VAC-07: Can remove vacation days (click to toggle off)
- ‚úÖ VAC-08: Prevents duplicates (Set-based logic in Plan 01)
- ‚úÖ AUTH-01: Works without authentication
- ‚úÖ AUTH-02: Data stores in localStorage
- ‚úÖ INTL-01/INTL-02: All text in Bulgarian Cyrillic

**Expected behavior:**
- Single click: toggle vacation on/off
- Drag: select range of days
- Light blue background on vacation days
- Holiday red wins over vacation blue
- Edit icon enables inline editing with accept/cancel
- Data persists across refresh
- No hydration warnings in console
  </how-to-verify>
  <resume-signal>
Type "approved" if all tests pass and vacation tracking works correctly.

If issues found, describe the problem with: what you did, what you expected, what happened instead, browser console errors (if any).
  </resume-signal>
</task>

</tasks>

<verification>
Phase 2 complete when:
- [ ] VacationSummary displays total, used, remaining days
- [ ] Inline editing works (edit ‚Üí save/cancel)
- [ ] CalendarDay shows blue background for vacation days
- [ ] Holiday styling takes precedence over vacation
- [ ] Legend includes vacation item
- [ ] VacationSummary renders on main page
- [ ] All text in Bulgarian Cyrillic
- [ ] No TypeScript errors
- [ ] Production build succeeds
- [ ] User verification passed
</verification>

<success_criteria>
- User can see vacation balance in right sidebar
- Total days editable with edit icon ‚Üí accept/cancel pattern
- Used days auto-calculated from marked dates
- Remaining days shows total - used (can be negative)
- Percentage used displays as text
- Vacation days have light blue background
- Holiday styling wins when day is both holiday and vacation
- Legend shows vacation color and label
- All Phase 2 requirements (VAC-01 through VAC-08, AUTH-01, AUTH-02) satisfied
- Bulgarian localization maintained (INTL-01, INTL-02)
</success_criteria>

<output>
After completion, create `.planning/phases/02-anonymous-vacation-tracking/02-02-SUMMARY.md` following the summary template.
</output>
