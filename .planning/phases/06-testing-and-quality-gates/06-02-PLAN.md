---
phase: 06-testing-and-quality-gates
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - jest.config.js
  - package.json
autonomous: true

must_haves:
  truths:
    - "Jest can test React components with jsdom environment"
    - "Coverage threshold is enforced at 50% for statements/branches/functions/lines"
    - "@testing-library/react is available for component testing"
  artifacts:
    - path: "jest.config.js"
      provides: "Updated Jest config with jsdom, coverage thresholds, RTL support"
      contains: "testEnvironment.*jsdom"
    - path: "package.json"
      provides: "Testing dependencies installed (RTL, jest-dom, user-event)"
      contains: "@testing-library/react"
  key_links:
    - from: "jest.config.js"
      to: "node_modules/@testing-library/react"
      via: "testEnvironment: jsdom enables DOM testing"
      pattern: "testEnvironment.*jsdom"
---

<objective>
Update Jest configuration to support component testing and enforce 50% coverage threshold.

Purpose: Enable React Testing Library for VacationContext and hook testing in upcoming plans.
Output: Updated Jest config with jsdom environment, coverage enforcement, and RTL dependencies installed.
</objective>

<execution_context>
@/home/nikolaymih11/.claude/get-shit-done/workflows/execute-plan.md
@/home/nikolaymih11/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-testing-and-quality-gates/06-RESEARCH.md

# Current Jest config
@jest.config.js

# Current dependencies
@package.json
</context>

<tasks>

<task type="auto">
  <name>Install React Testing Library dependencies</name>
  <files>package.json</files>
  <action>
Install testing dependencies needed for component and hook testing:

```bash
npm install -D @testing-library/react @testing-library/dom @testing-library/jest-dom @testing-library/user-event jest-environment-jsdom
```

Packages and versions:
- **@testing-library/react** (latest) - Component testing utilities
- **@testing-library/dom** (latest) - DOM query utilities (peer dependency)
- **@testing-library/jest-dom** (latest) - Custom matchers (toBeInTheDocument, toHaveTextContent)
- **@testing-library/user-event** (latest) - User interaction simulation (click, type, drag)
- **jest-environment-jsdom** (latest) - DOM environment for Jest (currently using 'node')

DO NOT install @playwright/test yet - that's in Plan 03.

Verify installation:
```bash
npm list @testing-library/react @testing-library/jest-dom jest-environment-jsdom
```

WHY: Current jest.config.js uses testEnvironment: 'node', which can't test React components. Need jsdom + RTL.
  </action>
  <verify>npm list @testing-library/react @testing-library/jest-dom jest-environment-jsdom --depth=0</verify>
  <done>RTL dependencies installed and visible in package.json devDependencies</done>
</task>

<task type="auto">
  <name>Update Jest configuration for component testing and coverage enforcement</name>
  <files>jest.config.js</files>
  <action>
Update jest.config.js to support component testing and enforce 50% coverage threshold per PROJECT.md requirement.

Replace entire file with:

```javascript
/** @type {import('jest').Config} */
const config = {
  preset: 'ts-jest',
  testEnvironment: 'jsdom', // Changed from 'node' for React component testing
  moduleNameMapper: {
    '^@/(.*)$': '<rootDir>/$1',
  },
  testMatch: [
    '**/*.test.ts',
    '**/*.test.tsx', // Added for component tests
  ],
  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'], // RTL custom matchers
  collectCoverageFrom: [
    'lib/**/*.{ts,tsx}',
    'components/**/*.{ts,tsx}',
    'contexts/**/*.{ts,tsx}',
    'hooks/**/*.{ts,tsx}',
    '!**/*.d.ts',
    '!**/node_modules/**',
    '!**/.next/**',
    '!lib/calendar/bridgeDays.test.ts', // Exclude test files
    '!lib/calendar/dates.test.ts',
    '!lib/vacation/rollover.test.ts',
    '!lib/avatar/initials.test.ts',
  ],
  coverageThreshold: {
    global: {
      statements: 50,
      branches: 50,
      functions: 50,
      lines: 50,
    },
  },
  coverageProvider: 'v8', // Faster than babel
};

module.exports = config;
```

Key changes:
1. **testEnvironment: 'jsdom'** - Enables DOM testing for React components
2. **testMatch includes .tsx** - Allows component test files
3. **setupFilesAfterEnv** - Loads RTL custom matchers (toBeInTheDocument, etc.)
4. **collectCoverageFrom** - Defines files to include in coverage (lib/, components/, contexts/, hooks/)
5. **coverageThreshold: 50%** - Enforces 50% minimum per PROJECT.md requirement
6. **coverageProvider: 'v8'** - Faster than default babel coverage

WHY: Current config can't test components. Coverage threshold enforces quality gate before shipping.
  </action>
  <verify>cat jest.config.js | grep -E "testEnvironment.*jsdom|coverageThreshold"</verify>
  <done>Jest config updated with jsdom environment and 50% coverage threshold</done>
</task>

<task type="auto">
  <name>Create Jest setup file for RTL custom matchers</name>
  <files>jest.setup.js</files>
  <action>
Create jest.setup.js to load @testing-library/jest-dom custom matchers.

File content:
```javascript
// jest.setup.js
// Load custom matchers from @testing-library/jest-dom
// Enables: expect(element).toBeInTheDocument(), .toHaveTextContent(), etc.
import '@testing-library/jest-dom';
```

This file is referenced by setupFilesAfterEnv in jest.config.js and runs before each test file.

Custom matchers provided by jest-dom:
- toBeDisabled()
- toBeEnabled()
- toBeEmptyDOMElement()
- toBeInTheDocument()
- toBeInvalid()
- toBeRequired()
- toBeValid()
- toBeVisible()
- toContainElement()
- toContainHTML()
- toHaveAttribute()
- toHaveClass()
- toHaveFocus()
- toHaveFormValues()
- toHaveStyle()
- toHaveTextContent()
- toHaveValue()
- toHaveDisplayValue()
- toBeChecked()
- toBePartiallyChecked()
- toHaveErrorMessage()

WHY: Makes test assertions more readable. expect(element).toBeInTheDocument() is clearer than expect(element).not.toBeNull().
  </action>
  <verify>cat jest.setup.js</verify>
  <done>jest.setup.js exists and imports @testing-library/jest-dom</done>
</task>

</tasks>

<verification>
Verify Jest configuration is valid:
```bash
npm test -- --listTests
```

Should show test files discovered by Jest (bridgeDays.test.ts and any new ones from Plan 01).

Verify coverage threshold works:
```bash
npm test -- --coverage --no-coverage-threshold
```

Should generate coverage report without failing (threshold check skipped with flag).
</verification>

<success_criteria>
1. RTL dependencies installed in package.json devDependencies
2. jest.config.js updated with jsdom environment
3. jest.setup.js created with jest-dom import
4. Coverage threshold set to 50% for all metrics
5. `npm test -- --listTests` shows discovered tests
6. Configuration changes don't break existing bridgeDays.test.ts
</success_criteria>

<output>
After completion, create `.planning/phases/06-testing-and-quality-gates/06-02-SUMMARY.md`
</output>
