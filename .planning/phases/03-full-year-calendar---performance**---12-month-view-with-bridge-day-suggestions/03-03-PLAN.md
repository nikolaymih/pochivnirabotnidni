---
phase: 03-full-year-calendar-performance
plan: 03
type: execute
wave: 2
depends_on: [03-01, 03-02]
files_modified:
  - components/FullYearCalendar.tsx
  - app/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can view all 12 months simultaneously"
    - "Layout is responsive (1 column mobile, 2 tablet, 3 desktop, 4 large)"
    - "Each month shows holidays in red and bridge days in yellow"
    - "Bridge days are calculated once and passed to all months"
    - "Vacation state persists across month boundaries"
  artifacts:
    - path: "components/FullYearCalendar.tsx"
      provides: "12-month grid container with bridge day detection"
      min_lines: 50
      contains: "Array.from({ length: 12 }"
    - path: "app/page.tsx"
      provides: "Full-year calendar integration replacing single month"
      contains: "FullYearCalendar"
  key_links:
    - from: "components/FullYearCalendar.tsx"
      to: "components/MonthGrid.tsx"
      via: "12 month instances"
      pattern: "<MonthGrid"
    - from: "components/FullYearCalendar.tsx"
      to: "lib/calendar/bridgeDays.ts"
      via: "detectBridgeDays call"
      pattern: "detectBridgeDays\\(holidays"
    - from: "app/page.tsx"
      to: "components/FullYearCalendar.tsx"
      via: "Import and render"
      pattern: "import.*FullYearCalendar"
    - from: "app/page.tsx"
      to: "VacationContext"
      via: "Client wrapper reads context and passes vacation data to Server Components"
      pattern: "VacationContextProvider|useVacationContext"
---

<objective>
Create the 12-month full-year calendar view with responsive grid layout and bridge day detection, replacing the single-month Calendar component in the main app.

Purpose: Fulfill CAL-01 requirement (full year view) and HOL-03 requirement (bridge day suggestions), delivering the core differentiator of seeing all holidays at once.

Output: Responsive 12-month calendar that displays holidays in red, bridge days in yellow, and vacation days in blue across the entire year.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-full-year-calendar---performance**---12-month-view-with-bridge-day-suggestions/03-RESEARCH.md

# Completed in this phase
@.planning/phases/03-full-year-calendar---performance**---12-month-view-with-bridge-day-suggestions/03-01-PLAN.md
@.planning/phases/03-full-year-calendar---performance**---12-month-view-with-bridge-day-suggestions/03-02-PLAN.md

# Current app structure
@app/page.tsx
@components/Calendar.tsx
@components/VacationSummary.tsx

# Dependencies
@lib/holidays/fetch.ts
@contexts/VacationContext.tsx

# Responsive grid from research
Mobile (base): grid-cols-1
Tablet (md:768px): grid-cols-2
Desktop (lg:1024px): grid-cols-3
Large (xl:1280px): grid-cols-4
</context>

<tasks>

<task type="auto">
  <name>Create FullYearCalendar component with responsive 12-month grid</name>
  <files>components/FullYearCalendar.tsx</files>
  <action>
Create `components/FullYearCalendar.tsx` as a Server Component:

**Props interface:**
```typescript
interface FullYearCalendarProps {
  year: number;
  vacationDates?: string[]; // Passed from client wrapper component
}
```

**Component logic:**

1. **Fetch holidays (Server Component pattern):**
   ```typescript
   import { getHolidaysForYear } from '@/lib/holidays/fetch';

   export default async function FullYearCalendar({ year, vacationDates = [] }: FullYearCalendarProps) {
     const holidays = await getHolidaysForYear(year);
     // ... rest
   }
   ```

2. **Calculate bridge days once:**
   ```typescript
   import { detectBridgeDays } from '@/lib/calendar/bridgeDays';

   const bridgeDays = detectBridgeDays(holidays, year);
   ```

3. **Render year header:**
   ```typescript
   <h1 className="text-3xl font-bold mb-6">{year}</h1>
   ```

4. **Responsive 12-month grid:**
   ```typescript
   <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
     {Array.from({ length: 12 }, (_, monthIndex) => {
       // Filter holidays for this month
       const monthHolidays = holidays.filter(h => {
         const holidayDate = new Date(h.date);
         return holidayDate.getMonth() === monthIndex;
       });

       // Filter bridge days for this month
       const monthBridges = bridgeDays.filter(b => {
         const bridgeDate = new Date(b.date);
         return bridgeDate.getMonth() === monthIndex;
       });

       return (
         <MonthGrid
           key={monthIndex}
           year={year}
           month={monthIndex}
           holidays={monthHolidays}
           bridgeDays={monthBridges}
           vacationDates={vacationDates}
           compact={true}
         />
       );
     })}
   </div>
   ```

5. **Vacation data flow pattern (Server Components cannot access context):**
   - FullYearCalendar is Server Component (cannot use VacationContext directly)
   - vacationDates prop receives data from client wrapper component
   - Client wrapper (created in app/page.tsx integration) reads VacationContext and passes string[] to Server Component
   - FullYearCalendar passes vacationDates to each MonthGrid

**Imports:**
```typescript
import { getHolidaysForYear } from '@/lib/holidays/fetch';
import { detectBridgeDays } from '@/lib/calendar/bridgeDays';
import MonthGrid from './MonthGrid';
```

**Container styling:**
```typescript
<div className="container mx-auto px-4 py-6">
  {/* Year header */}
  {/* 12-month grid */}
</div>
```

**Important considerations:**
- NO 'use client' - Server Component fetches holidays server-side
- Calculate bridge days ONCE for all 12 months (performance optimization)
- Filter holidays and bridges by month before passing to MonthGrid
- Responsive breakpoints: 1 col (mobile), 2 cols (tablet), 3 cols (desktop), 4 cols (large screens)
- Gap between months: gap-4 (16px spacing)
- vacationDates passed as prop from client wrapper (cannot access context directly)
  </action>
  <verify>
```bash
# File exists and is Server Component
test -f components/FullYearCalendar.tsx
! grep -q "'use client'" components/FullYearCalendar.tsx

# Has async function (Server Component pattern)
grep -q "export default async function FullYearCalendar" components/FullYearCalendar.tsx

# Imports bridge day detection
grep -q "detectBridgeDays" components/FullYearCalendar.tsx

# Has 12-month grid
grep -q "Array.from({ length: 12 }" components/FullYearCalendar.tsx

# Responsive grid classes
grep -q "grid-cols-1" components/FullYearCalendar.tsx
grep -q "md:grid-cols-2" components/FullYearCalendar.tsx
grep -q "lg:grid-cols-3" components/FullYearCalendar.tsx
grep -q "xl:grid-cols-4" components/FullYearCalendar.tsx

# Accepts vacationDates prop
grep -q "vacationDates" components/FullYearCalendar.tsx
```
  </verify>
  <done>
- FullYearCalendar.tsx created as async Server Component
- Fetches holidays for entire year server-side
- Calculates bridge days once using detectBridgeDays()
- Renders 12 MonthGrid components in responsive grid
- Grid responsive breakpoints: 1/2/3/4 columns (mobile/tablet/desktop/large)
- Filters holidays and bridge days by month before passing to MonthGrid
- Year header displays at top
- Accepts vacationDates prop (passed from client wrapper component)
  </done>
</task>

<task type="auto">
  <name>Integrate FullYearCalendar into main app page</name>
  <files>app/page.tsx</files>
  <action>
Update `app/page.tsx` to replace single-month Calendar with FullYearCalendar:

**Current state analysis:**
- app/page.tsx likely imports Calendar component
- May have VacationContext provider
- May have VacationSummary component

**Changes needed:**

1. **Create client wrapper component for vacation data wiring:**
   ```typescript
   'use client';

   import { useVacationContext } from '@/contexts/VacationContext';
   import FullYearCalendar from '@/components/FullYearCalendar';

   function FullYearCalendarWithVacations({ year }: { year: number }) {
     const { vacationDates } = useVacationContext();
     return <FullYearCalendar year={year} vacationDates={vacationDates} />;
   }
   ```

2. **Replace Calendar import:**
   ```typescript
   // Remove old Calendar import
   // import Calendar from '@/components/Calendar';
   ```

3. **Update component usage:**
   ```typescript
   // OLD (single month):
   // <Calendar year={2026} month={0} holidays={holidays} />

   // NEW (full year with client wrapper):
   <FullYearCalendarWithVacations year={2026} />
   ```

4. **Layout structure:**
   ```typescript
   export default async function Home() {
     return (
       <main className="min-h-screen">
         <VacationContextProvider>
           <div className="flex flex-col lg:flex-row gap-6">
             {/* Left: Full year calendar */}
             <div className="flex-1">
               <FullYearCalendarWithVacations year={2026} />
             </div>

             {/* Right: Vacation summary sidebar */}
             <div className="lg:w-80">
               <VacationSummary />
             </div>
           </div>
         </VacationContextProvider>
       </main>
     );
   }
   ```

5. **Make year dynamic (per Phase 1 decision):**
   ```typescript
   const currentYear = new Date().getFullYear();
   <FullYearCalendarWithVacations year={currentYear} />
   ```

**Important:**
- Create client wrapper component inline in app/page.tsx to bridge VacationContext (client) and FullYearCalendar (server)
- Keep VacationContext provider wrapping the layout
- Keep VacationSummary visible (sidebar on desktop, top on mobile)
- Remove old Calendar component usage
- Keep Legend component if it exists
- Use flex layout: column on mobile, row on desktop

**Responsive layout:**
- Mobile: Stack vertically (flex-col)
- Desktop (lg:1024px+): Side by side (lg:flex-row)
- Calendar takes flex-1 (grows to fill space)
- Summary fixed width lg:w-80 on desktop

**Pattern explanation:**
Server Components cannot access React Context. The client wrapper component ('use client') accesses VacationContext and passes the data as props to the Server Component. This is the standard Next.js App Router pattern for bridging client state to Server Components.
  </action>
  <verify>
```bash
# Imports FullYearCalendar
grep -q "FullYearCalendar" app/page.tsx

# Old Calendar import removed
! grep -q "import Calendar from" app/page.tsx || exit 1

# Has responsive layout
grep -q "flex-col" app/page.tsx
grep -q "lg:flex-row" app/page.tsx

# Uses current year or 2026
grep -q "year=" app/page.tsx

# Has client wrapper for vacation context bridge
grep -q "useVacationContext" app/page.tsx
```
  </verify>
  <done>
- app/page.tsx imports FullYearCalendar instead of Calendar
- Client wrapper component created to bridge VacationContext and Server Component
- FullYearCalendar displays with year prop (current year or 2026)
- Layout is responsive: vertical stack on mobile, horizontal split on desktop
- VacationSummary remains visible in sidebar
- VacationContext provider wraps components
- Old single-month Calendar component removed from page
- Vacation data flows from context through client wrapper to Server Component as props
  </done>
</task>

</tasks>

<verification>
Full-year calendar integration complete when:

1. **12-month view:**
   - All 12 months display simultaneously
   - Months arranged in responsive grid (1/2/3/4 columns)
   - Each month shows correct days for that month

2. **Bridge day suggestions:**
   - Yellow background on bridge days across all months
   - Bridge days only appear on Mondays after Tuesday holidays and Fridays after Thursday holidays
   - No bridge suggestions on dates that are already holidays

3. **Holiday display:**
   - Red background on all Bulgarian holidays
   - Holidays display in correct months

4. **Vacation persistence:**
   - Blue background on marked vacation days
   - Vacation state works across all 12 months
   - VacationSummary updates when vacation days marked

5. **Responsive layout:**
   - Mobile (< 768px): 1 column of months, summary above calendar
   - Tablet (768-1023px): 2 columns of months
   - Desktop (1024-1279px): 3 columns of months, summary sidebar
   - Large (1280px+): 4 columns of months

6. **Performance:**
   - Bridge days calculated once (not 12 times)
   - Server Component renders holidays server-side
   - No unnecessary client-side JavaScript

7. **Data wiring:**
   - Client wrapper component reads VacationContext
   - Vacation data passed as props to Server Component
   - MonthGrid receives vacation data and renders correctly
</verification>

<success_criteria>
**Phase 3 Plan 3 is complete when:**

- [ ] `components/FullYearCalendar.tsx` exists as async Server Component
- [ ] FullYearCalendar fetches holidays for entire year
- [ ] FullYearCalendar accepts vacationDates prop
- [ ] Bridge days calculated once using detectBridgeDays()
- [ ] 12 MonthGrid components render in responsive grid
- [ ] Grid uses Tailwind breakpoints: grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4
- [ ] app/page.tsx imports and renders FullYearCalendar
- [ ] Client wrapper component bridges VacationContext to Server Component
- [ ] Old single-month Calendar removed from app/page.tsx
- [ ] Layout responsive: flex-col on mobile, lg:flex-row on desktop
- [ ] VacationSummary displays in sidebar (desktop) or top (mobile)
- [ ] All 12 months visible on page
- [ ] Holidays display in red across all months
- [ ] Bridge days display in yellow across appropriate months
- [ ] Vacation days display in blue when marked
- [ ] Vacation data flows correctly from context through wrapper to display
</success_criteria>

<output>
After completion, create `.planning/phases/03-full-year-calendar---performance**---12-month-view-with-bridge-day-suggestions/03-03-SUMMARY.md` following the summary template.
</output>
