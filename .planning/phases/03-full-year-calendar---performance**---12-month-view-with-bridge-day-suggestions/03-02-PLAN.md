---
phase: 03-full-year-calendar-performance
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - components/MonthGrid.tsx
  - lib/calendar/grid.ts
autonomous: true

must_haves:
  truths:
    - "Single month displays in compact grid format"
    - "Month name shows in Bulgarian at top of grid"
    - "7-column layout positions first day correctly"
    - "Day cells show correct visual styling for holidays and bridge days"
    - "Weekend cells have distinct background color"
  artifacts:
    - path: "components/MonthGrid.tsx"
      provides: "Server Component for single month display"
      min_lines: 60
      contains: "export default function MonthGrid"
    - path: "lib/calendar/grid.ts"
      provides: "Month/year formatting utilities"
      exports: ["formatMonthYear"]
  key_links:
    - from: "components/MonthGrid.tsx"
      to: "lib/calendar/grid.ts"
      via: "getCalendarGrid import"
      pattern: "import.*getCalendarGrid.*from.*calendar/grid"
    - from: "components/MonthGrid.tsx"
      to: "date-fns/locale"
      via: "Bulgarian locale import"
      pattern: "import.*bg.*from 'date-fns/locale'"
    - from: "components/MonthGrid.tsx"
      to: "CalendarDay.tsx"
      via: "Day cell rendering"
      pattern: "CalendarDay"
---

<objective>
Create a Server Component that displays a single month in a compact 7-column grid with Bulgarian localization, serving as the building block for the 12-month full-year view.

Purpose: Reusable month component that scales from single month (Phase 1) to 12-month grid (Phase 3), with support for holidays, bridge days, and vacation marking.

Output: MonthGrid Server Component that renders one month with correct day positioning, weekend styling, and holiday/bridge day indicators.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-full-year-calendar---performance**---12-month-view-with-bridge-day-suggestions/03-RESEARCH.md

# Existing components and utilities
@components/Calendar.tsx
@components/CalendarDay.tsx
@lib/calendar/grid.ts
@lib/holidays/types.ts

# From Phase 1 decisions
Bulgarian localization: Use date-fns bg locale, capitalize month names
Server Components: No 'use client' unless interactivity needed
CSS Grid: 7-column layout with gridColumnStart for first day positioning

# Vacation data wiring pattern
MonthGrid is Server Component → receives vacationDates as string[] prop
Cannot access VacationContext directly (Server Components don't support context)
Parent component (FullYearCalendar) receives vacationDates from client wrapper
</context>

<tasks>

<task type="auto">
  <name>Create MonthGrid Server Component with compact layout</name>
  <files>components/MonthGrid.tsx</files>
  <action>
Create `components/MonthGrid.tsx` as a Server Component (NO 'use client' directive):

**Props interface:**
```typescript
interface MonthGridProps {
  year: number;
  month: number; // 0-11 (JavaScript month indexing)
  holidays: Holiday[];
  bridgeDays: BridgeDay[];
  vacationDates?: string[]; // From parent, ultimately from VacationContext via client wrapper
  compact?: boolean; // Default true for 12-month view
}
```

**Component structure:**

1. **Month header:**
   - Use `format(new Date(year, month, 1), 'MMMM', { locale: bg })` for month name
   - Capitalize first letter: `.charAt(0).toUpperCase() + rest`
   - Display as h3 with text-lg font-semibold

2. **7-column grid container:**
   - `<div className="grid grid-cols-7 gap-1 text-xs">`
   - Day headers: ['П', 'В', 'С', 'Ч', 'П', 'С', 'Н'] (single letter abbreviations for compact view)
   - Use text-gray-600 for headers

3. **Day cells:**
   - Use `getCalendarGrid(year, month)` to get days and firstDayOfWeek
   - For each day, calculate:
     - dateStr: `format(new Date(year, month, day), 'yyyy-MM-dd')`
     - isHoliday: Check if dateStr in holidays array
     - isBridge: Check if dateStr in bridgeDays array (will import from Plan 03-01)
     - isVacation: Check if dateStr in vacationDates array (prop received from parent)
     - isWeekend: `(firstDayOfWeek + index) % 7 >= 5`

4. **Styling logic (Tailwind classes):**
   - Base: `p-2 text-center rounded text-xs`
   - Holiday: `bg-red-100 text-red-900 font-semibold`
   - Bridge: `bg-yellow-100 text-yellow-900`
   - Vacation: `bg-blue-100 text-blue-900`
   - Weekend (not holiday/bridge/vacation): `bg-gray-50 text-gray-500`
   - Workday: `hover:bg-gray-100 cursor-pointer`
   - First day positioning: `style={{ gridColumnStart: firstDayOfWeek + 1 }}` (only for index === 0)

5. **Priority order for styling:**
   - Holiday > Bridge > Vacation > Weekend > Workday
   - If a date is both holiday and vacation, holiday wins (red)

**Imports:**
```typescript
import { format } from 'date-fns';
import { bg } from 'date-fns/locale';
import { getCalendarGrid } from '@/lib/calendar/grid';
import type { Holiday } from '@/lib/holidays/types';
import type { BridgeDay } from '@/lib/calendar/bridgeDays';
```

**Container styling:**
```typescript
<div className="border border-gray-200 rounded-lg p-3 bg-white shadow-sm">
  {/* Month name */}
  {/* Grid */}
</div>
```

**Important:**
- NO 'use client' - this is a Server Component
- Compact mode: smaller text (text-xs), tighter spacing (gap-1, p-2)
- Use existing CalendarDay component patterns for consistency
- Include today indicator: Check if date matches current date, add blue ring: `ring-2 ring-blue-500`
- vacationDates prop is string[] received from parent (Server Components cannot access context)

**Vacation data wiring:**
MonthGrid receives vacationDates as prop → Parent FullYearCalendar receives it from client wrapper → Client wrapper reads VacationContext and passes string[] down. This is the standard Next.js App Router pattern for Server Components accessing client state.
  </action>
  <verify>
```bash
# File exists and is Server Component
test -f components/MonthGrid.tsx
! grep -q "'use client'" components/MonthGrid.tsx  # Should NOT have 'use client'

# Has correct imports
grep -q "from 'date-fns'" components/MonthGrid.tsx
grep -q "from 'date-fns/locale'" components/MonthGrid.tsx
grep -q "getCalendarGrid" components/MonthGrid.tsx

# Has 7-column grid
grep -q "grid-cols-7" components/MonthGrid.tsx

# Handles all day types
grep -q "bg-red-100" components/MonthGrid.tsx  # Holiday styling
grep -q "bg-yellow-100" components/MonthGrid.tsx  # Bridge styling
grep -q "bg-blue-100" components/MonthGrid.tsx  # Vacation styling
grep -q "bg-gray-50" components/MonthGrid.tsx  # Weekend styling

# Accepts vacationDates prop
grep -q "vacationDates" components/MonthGrid.tsx
```
  </verify>
  <done>
- MonthGrid.tsx created as Server Component (no 'use client')
- Displays single month with Bulgarian localized name
- 7-column CSS Grid with correct first-day positioning
- Day headers show single-letter abbreviations (П, В, С, Ч, П, С, Н)
- Styling differentiates holidays (red), bridge days (yellow), vacation (blue), weekends (gray)
- Compact mode with smaller text and tighter spacing for 12-month view
- Today indicator shows blue ring on current date
- Accepts vacationDates prop (string[]) from parent for Server Component compatibility
  </done>
</task>

<task type="auto">
  <name>Add formatMonthYear utility to calendar grid helpers</name>
  <files>lib/calendar/grid.ts</files>
  <action>
Extend existing `lib/calendar/grid.ts` with month/year formatting utility:

**Add function:**
```typescript
import { format } from 'date-fns';
import { bg } from 'date-fns/locale';

/**
 * Format month and year for display in Bulgarian
 * @param year - Full year (e.g. 2026)
 * @param month - Month index 0-11
 * @returns Formatted string like "Януари 2026"
 */
export function formatMonthYear(year: number, month: number): string {
  const date = new Date(year, month, 1);
  const monthName = format(date, 'MMMM', { locale: bg });
  // Capitalize first letter (Bulgarian localization)
  const capitalizedMonth = monthName.charAt(0).toUpperCase() + monthName.slice(1);
  return `${capitalizedMonth} ${year}`;
}
```

This utility can be used by both MonthGrid (compact header) and FullYearCalendar (year view).

**Keep existing exports:**
- getCalendarGrid
- Any other existing functions

Just add formatMonthYear as an additional export.
  </action>
  <verify>
```bash
# Function exists
grep -q "export function formatMonthYear" lib/calendar/grid.ts

# Uses Bulgarian locale
grep -q "locale: bg" lib/calendar/grid.ts

# Capitalizes month name
grep -q "charAt(0).toUpperCase()" lib/calendar/grid.ts
```
  </verify>
  <done>
- formatMonthYear() utility added to lib/calendar/grid.ts
- Uses date-fns bg locale for Bulgarian month names
- Capitalizes first letter per Phase 1 decision
- Returns formatted string like "Януари 2026"
- Available for import by MonthGrid and FullYearCalendar
  </done>
</task>

</tasks>

<verification>
MonthGrid component implementation complete when:

1. **Server Component:**
   - No 'use client' directive (confirmed with grep)
   - Can be imported and used in other Server Components

2. **Layout:**
   - 7-column CSS Grid displays correctly
   - First day of month positions on correct weekday column
   - Day headers show Bulgarian single-letter abbreviations

3. **Styling:**
   - Red background for holidays
   - Yellow background for bridge days
   - Blue background for vacation days
   - Gray background for weekends
   - Hover state on workdays

4. **Localization:**
   - Month name in Bulgarian (using date-fns bg locale)
   - First letter capitalized

5. **Visual consistency:**
   - Compact mode suitable for 12-month grid
   - Matches existing Calendar.tsx styling patterns

6. **Data wiring:**
   - vacationDates received as prop (string[])
   - Server Component compatible pattern
</verification>

<success_criteria>
**Phase 3 Plan 2 is complete when:**

- [ ] `components/MonthGrid.tsx` exists as Server Component (no 'use client')
- [ ] MonthGrid displays single month in 7-column grid
- [ ] Month name appears in Bulgarian with capitalized first letter
- [ ] Day headers show single-letter abbreviations (П, В, С, Ч, П, С, Н)
- [ ] First day of month positions correctly using gridColumnStart
- [ ] Holidays display with red background (bg-red-100)
- [ ] Bridge days display with yellow background (bg-yellow-100)
- [ ] Vacation days display with blue background (bg-blue-100)
- [ ] Weekends display with gray background (bg-gray-50)
- [ ] Today's date shows blue ring indicator (ring-2 ring-blue-500)
- [ ] `lib/calendar/grid.ts` exports formatMonthYear utility
- [ ] Component uses date-fns for all date formatting
- [ ] Compact styling suitable for 12-month grid view
- [ ] Accepts vacationDates prop as string[] for Server Component compatibility
</success_criteria>

<output>
After completion, create `.planning/phases/03-full-year-calendar---performance**---12-month-view-with-bridge-day-suggestions/03-02-SUMMARY.md` following the summary template.
</output>
