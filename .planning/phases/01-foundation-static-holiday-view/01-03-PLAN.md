---
phase: 01-foundation-static-holiday-view
plan: 03
type: execute
wave: 3
depends_on: [01-02]
files_modified:
  - components/DayTooltip.tsx
  - components/CalendarDay.tsx
  - app/page.tsx
  - app/layout.tsx
autonomous: true

must_haves:
  truths:
    - "User can view 2026 Bulgarian holidays in calendar (month view)"
    - "Official holidays display in red color with correct dates"
    - "User can hover over holidays to see name, date, and type"
    - "User can tap holidays on mobile to see details"
    - "Current date has visual indicator"
    - "Legend explains color meanings"
  artifacts:
    - path: "components/DayTooltip.tsx"
      provides: "Client Component for interactive tooltip"
      contains: "'use client'"
      min_lines: 30
    - path: "app/page.tsx"
      provides: "Main calendar page"
      contains: "getHolidays"
      min_lines: 25
    - path: "app/layout.tsx"
      provides: "Updated app metadata"
      contains: "Pochivni Rabotni Dni"
  key_links:
    - from: "components/CalendarDay.tsx"
      to: "components/DayTooltip.tsx"
      via: "conditional rendering for holidays"
      pattern: "DayTooltip.*holiday"
    - from: "app/page.tsx"
      to: "lib/holidays/fetch.ts"
      via: "server-side holiday data fetch"
      pattern: "getHolidays"
    - from: "app/page.tsx"
      to: "components/Calendar.tsx"
      via: "calendar rendering with props"
      pattern: "<Calendar"
    - from: "components/DayTooltip.tsx"
      to: "useState"
      via: "tooltip visibility state"
      pattern: "useState.*isVisible"
---

<objective>
Add interactive tooltips for holiday details showing name, date, and type, integrate calendar into main page, and prepare for human verification of the complete Phase 01 implementation.

Purpose: Complete the user-facing calendar by adding mobile-friendly tooltips that work on both hover (desktop) and tap (mobile), displaying holiday name, date, and type. Replace boilerplate content with the actual calendar, and enable autonomous verification of all Phase 01 requirements.

Output: Working tooltip with dual interaction modes showing complete holiday info, production-ready main page with calendar and legend, updated metadata, and verified Phase 01 success criteria.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-static-holiday-view/01-CONTEXT.md
@.planning/phases/01-foundation-static-holiday-view/01-RESEARCH.md
@.planning/codebase/CONVENTIONS.md

# Reference prior plan outputs
@.planning/phases/01-foundation-static-holiday-view/01-01-SUMMARY.md
@.planning/phases/01-foundation-static-holiday-view/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create interactive tooltip Client Component with complete holiday info</name>
  <files>components/DayTooltip.tsx, components/CalendarDay.tsx</files>
  <action>
Create tooltip as Client Component to handle hover and tap interactions. Display holiday name, date, and type per HOL-04 requirement. Update CalendarDay to include tooltip for holidays.

**File: components/DayTooltip.tsx**
```typescript
'use client';

import { useState } from 'react';
import { format } from 'date-fns';
import { parseDate } from '@/lib/calendar/dates';
import type { Holiday } from '@/lib/holidays/types';

interface DayTooltipProps {
  holiday: Holiday;
}

export default function DayTooltip({ holiday }: DayTooltipProps) {
  const [isVisible, setIsVisible] = useState(false);

  return (
    <div className="absolute top-1 right-1">
      <button
        onMouseEnter={() => setIsVisible(true)}
        onMouseLeave={() => setIsVisible(false)}
        onClick={(e) => {
          e.stopPropagation();
          setIsVisible(!isVisible);
        }}
        className="text-xs bg-white text-gray-800 rounded-full w-5 h-5 flex items-center justify-center font-bold hover:bg-gray-100 transition-colors"
        aria-label="Holiday details"
        type="button"
      >
        i
      </button>

      {isVisible && (
        <div className="absolute right-0 top-7 z-10 w-48 p-3 bg-gray-900 text-white text-sm rounded shadow-lg">
          <div className="font-bold mb-1">{holiday.name}</div>
          <div className="text-xs opacity-80 mb-1">
            {format(parseDate(holiday.date), 'MMM d, yyyy')}
          </div>
          <div className="text-xs opacity-80">{holiday.type}</div>
        </div>
      )}
    </div>
  );
}
```

**Update File: components/CalendarDay.tsx**
Add import and conditional tooltip rendering:
```typescript
import type { Holiday } from '@/lib/holidays/types';
import DayTooltip from './DayTooltip';

interface CalendarDayProps {
  day: number;
  isToday: boolean;
  isWeekend: boolean;
  holiday?: Holiday;
  gridColumnStart?: number;
}

export default function CalendarDay({
  day,
  isToday,
  isWeekend,
  holiday,
  gridColumnStart
}: CalendarDayProps) {
  return (
    <div
      style={gridColumnStart ? { gridColumnStart } : undefined}
      className={`
        relative p-3 text-center border rounded min-h-[3rem]
        ${holiday ? 'bg-red-500 text-white' : ''}
        ${isWeekend && !holiday ? 'bg-gray-100' : ''}
        ${isToday ? 'ring-2 ring-blue-500' : ''}
      `}
    >
      <span className="font-medium">{day}</span>
      {holiday && <DayTooltip holiday={holiday} />}
    </div>
  );
}
```

CRITICAL HOL-04 requirement: Tooltip MUST show:
1. Holiday name (holiday.name) ✓
2. Holiday date (formatted: "MMM d, yyyy") ✓
3. Holiday type (holiday.type) ✓

CRITICAL Tailwind v4 mobile handling: Must combine onMouseEnter (desktop hover) with onClick (mobile tap). Tailwind v4 hover: pseudo-class only applies on hover-capable devices per research. The onClick handler ensures mobile users can tap to toggle tooltip.

Do NOT use hover-only interaction - it breaks on mobile devices.
  </action>
  <verify>
```bash
# Check file exists
test -f components/DayTooltip.tsx && echo "✓ DayTooltip.tsx exists"

# Verify Client Component
grep -q "'use client'" components/DayTooltip.tsx && echo "✓ DayTooltip is Client Component"

# Verify dual interaction (hover + tap)
grep -q "onMouseEnter" components/DayTooltip.tsx && echo "✓ Has onMouseEnter for desktop"
grep -q "onClick" components/DayTooltip.tsx && echo "✓ Has onClick for mobile"

# Verify HOL-04: tooltip shows name, date, type
grep -q "holiday.name" components/DayTooltip.tsx && echo "✓ Shows holiday name"
grep -q "format.*holiday.date" components/DayTooltip.tsx && echo "✓ Shows formatted date"
grep -q "holiday.type" components/DayTooltip.tsx && echo "✓ Shows holiday type"

# Verify CalendarDay imports tooltip
grep -q "import DayTooltip" components/CalendarDay.tsx && echo "✓ CalendarDay imports DayTooltip"
grep -q "DayTooltip.*holiday" components/CalendarDay.tsx && echo "✓ CalendarDay renders tooltip conditionally"

# Build check
npm run build
```
  </verify>
  <done>
DayTooltip Client Component created with useState for visibility, supports both hover and tap interactions, displays holiday name, formatted date (MMM d, yyyy), and type per HOL-04 requirement, CalendarDay conditionally renders tooltip for holidays, build succeeds
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate calendar into main page and update metadata</name>
  <files>app/page.tsx, app/layout.tsx</files>
  <action>
Replace boilerplate content with actual calendar implementation showing current month. Update metadata for production.

**File: app/page.tsx**
```typescript
import { getYear } from 'date-fns';
import { getHolidays } from '@/lib/holidays/fetch';
import Calendar from '@/components/Calendar';
import Legend from '@/components/Legend';

export default async function HomePage() {
  const currentDate = new Date();
  const year = getYear(currentDate);
  const month = currentDate.getMonth(); // 0-11

  // Fetch holidays server-side (defaults to 2026 for Phase 1 scope)
  const holidays = await getHolidays(2026);

  return (
    <main className="container mx-auto p-4 max-w-6xl">
      <h1 className="text-3xl font-bold mb-6">Pochivni Rabotni Dni 2026</h1>
      <p className="text-gray-600 mb-8">
        Bulgarian holidays and workdays calendar for planning your year
      </p>

      <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
        <div className="lg:col-span-3">
          <Calendar year={2026} month={month} holidays={holidays} />
        </div>
        <div className="lg:col-span-1">
          <Legend />
        </div>
      </div>
    </main>
  );
}
```

**Update File: app/layout.tsx**
Update metadata only (keep rest of file as-is):
```typescript
export const metadata: Metadata = {
  title: "Pochivni Rabotni Dni - Bulgarian Holidays Calendar 2026",
  description: "View Bulgarian public holidays and plan your vacation days with an interactive calendar for 2026",
};
```

LAYOUT REQUIREMENTS per context:
- Legend in sidebar next to calendar ✓
- Default to current month on load ✓
- Calendar displays 2026 holidays (Phase 1 scope)

CRITICAL SCOPE CLARIFICATION: Phase 1 shows current month view of 2026. The calendar fetches all 2026 holidays but displays only the current month (via month parameter). Success criteria updated to reflect this.

Replace ALL boilerplate content from page.tsx. Keep layout.tsx mostly unchanged (fonts, structure), only update metadata.
  </action>
  <verify>
```bash
# Check boilerplate removed
! grep -q "Get started by editing" app/page.tsx && echo "✓ Boilerplate removed from page.tsx"

# Verify calendar integration
grep -q "getHolidays" app/page.tsx && echo "✓ Fetches holidays"
grep -q "<Calendar" app/page.tsx && echo "✓ Renders Calendar component"
grep -q "<Legend" app/page.tsx && echo "✓ Renders Legend component"

# Verify current month display
grep -q "month.*getMonth" app/page.tsx && echo "✓ Uses current month"

# Verify metadata updated
grep -q "Pochivni Rabotni Dni" app/layout.tsx && echo "✓ Metadata updated"

# Verify server-side data fetching
grep -q "async function HomePage" app/page.tsx && echo "✓ Page is async Server Component"

# Dev server check
npm run dev &
DEV_PID=$!
sleep 5
curl -f http://localhost:3000 > /dev/null 2>&1 && echo "✓ Dev server responds"
kill $DEV_PID

# Build check
npm run build
```
  </verify>
  <done>
Main page displays calendar with current month of 2026 holidays and legend sidebar, boilerplate content removed, metadata updated, server-side data fetching works, dev server and build both succeed
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 01 calendar implementation:
- Custom calendar grid with Monday-first weeks
- Bulgarian 2026 holidays in red (#EF4444)
- Interactive tooltips showing name, date, and type (hover on desktop, tap on mobile)
- Weekend styling (subtle gray background)
- Current date indicator (blue border)
- Color legend in sidebar
- Safari-safe date handling with date-fns (parseISO, getCurrentDate with startOfDay)
- Multi-layer holiday data fallback (API → static JSON)
- Current month display (Phase 1 scope)
  </what-built>

  <how-to-verify>
**Step 1: Start Development Server**
```bash
npm run dev
```
Visit: http://localhost:3000

**Step 2: Visual Verification**
- [ ] Calendar displays current month of 2026 (e.g., January 2026 if running in January)
- [ ] Week headers show Mon, Tue, Wed, Thu, Fri, Sat, Sun (in that order)
- [ ] First day of month appears in correct column (no adjacent month days)
- [ ] January 1 (New Year's Day) has red background (#EF4444) if viewing January
- [ ] Weekends (Saturday, Sunday) have subtle gray background
- [ ] Current date has blue border/ring indicator
- [ ] Legend in sidebar explains: Red=Holiday, Gray=Weekend, Blue border=Today

**Step 3: Interaction Testing (Desktop)**
- [ ] Hover over red holiday cell (e.g., Jan 1 if viewing January)
- [ ] Tooltip appears showing holiday name (e.g., "New Year's Day")
- [ ] Tooltip shows formatted date (e.g., "Jan 1, 2026")
- [ ] Tooltip shows holiday type (e.g., "Public Holiday")
- [ ] Move mouse away, tooltip disappears
- [ ] Hover over other red cells in month, tooltips work

**Step 4: Interaction Testing (Mobile)**
Open Chrome DevTools, toggle device toolbar (Cmd+Shift+M / Ctrl+Shift+M):
- [ ] Tap red holiday cell
- [ ] Tooltip appears showing name, date, and type
- [ ] Tap again or tap elsewhere, tooltip disappears
- [ ] Tap works on all holiday cells

**Step 5: Safari Compatibility**
Open http://localhost:3000 in Safari:
- [ ] Calendar loads without errors
- [ ] Dates display correctly (no timezone offset issues)
- [ ] Holidays appear on correct days
- [ ] Current date indicator shows on actual current date
- [ ] Tooltips work on hover
- [ ] No console errors in Safari Web Inspector

**Step 6: Responsive Layout**
Resize browser window:
- [ ] Legend moves below calendar on mobile (<1024px)
- [ ] Calendar remains readable and functional
- [ ] No horizontal scrolling required

**Step 7: Browser Console**
Check for errors:
- [ ] No TypeScript errors
- [ ] No React hydration errors
- [ ] No date parsing warnings
  </how-to-verify>

  <resume-signal>
Reply with one of:
- "approved" - Phase 01 complete, all criteria met
- "issues: [describe problems]" - Specific issues found, need fixes
  </resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Tooltip Interaction**: Works on both desktop (hover) and mobile (tap)
2. **Tooltip Content**: Shows name, formatted date, and type per HOL-04
3. **Client Boundary**: Only DayTooltip is Client Component, rest are Server Components
4. **Main Page**: Calendar integrated showing current month, boilerplate removed, metadata updated
5. **Holiday Data**: 2026 Bulgarian holidays display correctly in red
6. **Visual Styling**: Red holidays, gray weekends, blue current date indicator
7. **Legend**: Color meanings explained in sidebar
8. **Safari Compatibility**: Dates parse correctly using parseISO, current date uses getCurrentDate with startOfDay
9. **Mobile Responsive**: Layout adapts, touch targets work
10. **Scope**: Shows current month view (Phase 1), fetches all 2026 holidays
</verification>

<success_criteria>
Phase 01, Plan 03 (and entire Phase 01) is complete when:

- [x] DayTooltip Client Component shows holiday name, formatted date, and type (HOL-04)
- [x] Tooltip supports both onMouseEnter (desktop) and onClick (mobile)
- [x] CalendarDay conditionally renders tooltip for holidays only
- [x] app/page.tsx fetches holidays server-side and renders Calendar + Legend
- [x] app/page.tsx passes current month to Calendar component
- [x] app/layout.tsx has updated metadata for production
- [x] Boilerplate content removed from page.tsx
- [x] Dev server runs without errors at http://localhost:3000
- [x] Calendar displays current month with correct styling (red holidays, gray weekends, blue today)
- [x] Human verification confirms all Phase 01 success criteria met:
  1. User can view 2026 Bulgarian holidays in calendar (current month view) ✓
  2. Official holidays display in red color with correct dates ✓
  3. User can hover/tap to see holiday name, date, and type ✓
  4. Legend displays color meanings ✓
  5. Works in Safari and Chrome (Safari-safe date handling) ✓
  6. Current date has visual indicator ✓
</success_criteria>

<output>
After completion and approval, create `.planning/phases/01-foundation-static-holiday-view/01-03-SUMMARY.md`
</output>
