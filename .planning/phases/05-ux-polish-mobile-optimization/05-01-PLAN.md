---
phase: 05-ux-polish-mobile-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/MonthGrid.tsx
  - components/FullYearCalendarWrapper.tsx
  - components/FullYearCalendar.tsx
autonomous: true

must_haves:
  truths:
    - "Touch drag selection works smoothly on mobile without blocking page scroll"
    - "Tapping a day cell shows brief highlight flash before toggling"
    - "All interactive day cells meet 44px minimum touch target size"
    - "Dragging across multiple days selects/deselects range on mobile"
  artifacts:
    - path: "components/MonthGrid.tsx"
      provides: "Touch-optimized day cells with 44px targets, highlight flash, touch-action:none"
      contains: "touch-none"
    - path: "components/FullYearCalendarWrapper.tsx"
      provides: "Pointer event handlers for drag selection (pointerDown, pointerEnter, pointerUp)"
      contains: "onPointerDown"
    - path: "components/FullYearCalendar.tsx"
      provides: "Passes drag selection handlers to MonthGrid"
      contains: "onPointerDown"
  key_links:
    - from: "components/FullYearCalendarWrapper.tsx"
      to: "components/FullYearCalendar.tsx"
      via: "pointer event handler props"
      pattern: "onPointer(Down|Enter|Up)"
    - from: "components/FullYearCalendar.tsx"
      to: "components/MonthGrid.tsx"
      via: "pointer event handler props passed to each month"
      pattern: "onPointer(Down|Enter|Up)"
---

<objective>
Add touch-optimized drag selection and accessible touch targets to the calendar grid.

Purpose: Mobile users currently can only tap one day at a time. This plan adds smooth touch drag selection (tap and drag across days), brief highlight flash on tap for visual feedback, and ensures all interactive cells meet WCAG 44px minimum touch target size. The existing Pointer Events API is already in the codebase pattern (from Phase 2 decisions) but MonthGrid currently only uses onClick. This plan upgrades to full pointer event handling.

Output: MonthGrid with touch-action:none CSS, 44px min touch targets, highlight flash animation, and drag selection via pointer events propagated from FullYearCalendarWrapper through FullYearCalendar.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-ux-polish-mobile-optimization/05-CONTEXT.md
@.planning/phases/05-ux-polish-mobile-optimization/05-RESEARCH.md
@components/MonthGrid.tsx
@components/FullYearCalendarWrapper.tsx
@components/FullYearCalendar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add pointer event drag selection to FullYearCalendarWrapper and FullYearCalendar</name>
  <files>components/FullYearCalendarWrapper.tsx, components/FullYearCalendar.tsx</files>
  <action>
  In FullYearCalendarWrapper.tsx:
  - Add drag selection state: `isDragging` (boolean), `dragMode` (add/remove - determined by first cell's current state), `dragStartDate` (string | null)
  - Create `handlePointerDown(dateStr)`: Sets isDragging=true, determines dragMode based on whether dateStr is currently in vacationDates (if present: mode=remove, if absent: mode=add), toggles the date immediately for instant feedback
  - Create `handlePointerEnter(dateStr)`: If isDragging, applies dragMode to this date (add to vacationDates if mode=add and not present, remove if mode=remove and present). Use Set-based logic to prevent duplicates (existing pattern from Phase 2 decision VAC-08)
  - Create `handlePointerUp()`: Sets isDragging=false, clears dragStartDate
  - Add document-level pointerup listener in useEffect to catch pointer-up outside calendar (prevents stuck drag state). Clean up on unmount.
  - Pass handlePointerDown, handlePointerEnter, handlePointerUp as props to FullYearCalendar

  In FullYearCalendar.tsx:
  - Add new props: `onPointerDown?: (dateStr: string) => void`, `onPointerEnter?: (dateStr: string) => void`, `onPointerUp?: () => void`
  - Pass these three handlers down to each MonthGrid component
  - Keep existing onToggleDate prop for backward compatibility but it will no longer be the primary interaction path on the day cells

  IMPORTANT: Do NOT use mouse events or touch events separately. Use Pointer Events only (established codebase pattern from 02-01 decision).
  IMPORTANT: Holidays are NOT clickable/draggable (existing isClickable logic in MonthGrid must be respected).
  </action>
  <verify>
  - `npm run build` passes with no type errors
  - FullYearCalendarWrapper has isDragging, dragMode state
  - FullYearCalendar accepts and passes onPointerDown, onPointerEnter, onPointerUp props
  - Document-level pointerup cleanup exists in useEffect return
  </verify>
  <done>Drag selection state machine exists in FullYearCalendarWrapper. Pointer event handlers flow from wrapper -> FullYearCalendar -> MonthGrid props.</done>
</task>

<task type="auto">
  <name>Task 2: Touch-optimize MonthGrid with 44px targets, touch-action, highlight flash, and pointer event wiring</name>
  <files>components/MonthGrid.tsx</files>
  <action>
  Enhance MonthGrid day cells with:

  1. **Touch targets (44px minimum):**
     - Add `min-w-[44px] min-h-[44px]` Tailwind classes to each day cell div
     - Keep existing text-xs and text centering (compact mode still looks good, just cells are larger touch targets)
     - Use `flex items-center justify-center` for centering the day number within the larger cell

  2. **touch-action: none CSS:**
     - Add Tailwind class `touch-none` to each clickable day cell (only when isClickable is true)
     - This prevents browser scroll/zoom on cells that support drag, per RESEARCH.md Pattern 1
     - Do NOT add touch-none to the overall grid container (Pitfall 3: would break page scrolling)

  3. **Highlight flash on tap:**
     - Add CSS class `transition-colors duration-150` to day cells
     - On pointerDown for clickable cells, briefly add a `bg-gray-200` class that auto-removes via CSS transition
     - Implementation: Use a `highlightedDate` state (string|null). On pointerDown set it to dateStr, use setTimeout(150ms) to clear it. Apply `bg-gray-200` when dateStr matches highlightedDate.
     - Since MonthGrid is currently a Server Component, it must be converted to 'use client' to support the highlight state and pointer events. Add 'use client' directive at top.

  4. **Wire pointer events:**
     - Accept new optional props: `onPointerDown?: (dateStr: string) => void`, `onPointerEnter?: (dateStr: string) => void`, `onPointerUp?: () => void`
     - Replace current `onClick={handleClick}` with pointer events:
       - `onPointerDown`: Call onPointerDown prop (if exists and isClickable). Set highlight state.
       - `onPointerEnter`: Call onPointerEnter prop (if exists and isClickable)
       - `onPointerUp`: Call onPointerUp prop (if exists)
     - Keep onClick as fallback for accessibility (keyboard/screen reader users), but primary interaction is now pointer events
     - Holiday cells (isClickable=false) get NO pointer handlers and NO touch-none class

  IMPORTANT: MonthGrid was a Server Component. Converting to 'use client' is necessary for pointer event state. This is acceptable - the component needs interactivity now. The parent FullYearCalendar is already 'use client'.
  IMPORTANT: Only apply touch-none to individual day cells that are clickable, NEVER to the grid container or month wrapper. Users must still be able to scroll the page.
  </action>
  <verify>
  - `npm run build` passes
  - MonthGrid has 'use client' directive
  - Day cells have `min-w-[44px] min-h-[44px]` classes
  - Clickable cells have `touch-none` class
  - Non-clickable cells (holidays) do NOT have touch-none
  - onPointerDown, onPointerEnter, onPointerUp props exist on MonthGrid interface
  - highlightedDate state exists for flash animation
  </verify>
  <done>MonthGrid day cells are 44px minimum touch targets with touch-action:none on clickable cells, brief highlight flash on tap via pointer events, and drag selection wired through from parent components. Page scrolling is not affected.</done>
</task>

</tasks>

<verification>
- `npm run build` completes without errors
- MonthGrid cells have min 44px dimensions (inspect with browser dev tools)
- Drag across multiple day cells selects/deselects a range (test in browser)
- Page still scrolls vertically on mobile (touch-action:none only on individual cells)
- Holidays cannot be selected via drag
- Existing click behavior still works for single-day toggling
</verification>

<success_criteria>
- Touch drag selection works: press on one day, drag to another, all days in path are toggled
- 44px minimum touch targets on all interactive day cells
- Brief highlight flash visible on tap
- Page scrolling not broken on mobile
- No type errors, build passes
</success_criteria>

<output>
After completion, create `.planning/phases/05-ux-polish-mobile-optimization/05-01-SUMMARY.md`
</output>
