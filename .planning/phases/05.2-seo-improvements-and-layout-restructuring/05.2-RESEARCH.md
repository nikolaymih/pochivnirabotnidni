# Phase 5.2: SEO Improvements & Layout Restructuring - Research

**Gathered:** 2026-02-07
**Status:** Complete

## Research Question

What do I need to know to PLAN this phase well?

## Key Findings

### 1. OpenHolidays API - School Holidays Support

**Endpoint Discovered:**
```
GET https://openholidaysapi.org/SchoolHolidays
```

**Parameters:**
- `countryIsoCode` (required) - e.g., "BG" for Bulgaria
- `validFrom` (required) - ISO date string (YYYY-MM-DD)
- `validTo` (required) - ISO date string (YYYY-MM-DD)
- `subdivisionCode` (optional) - for regional filtering
- `languageIsoCode` (optional) - response language preference

**Bulgaria Support:**
- YES - School holidays supported from 2020 onwards
- API documentation confirms: "Bulgaria (public holidays and school holidays from 2020)"

**Response Format (JSON):**
```json
{
  "id": "aee5fb0c-7b33-4a4b-9bf2-ea95acaf4c67",
  "startDate": "2025-12-24",
  "endDate": "2026-01-04",
  "type": "School",
  "name": [
    {"language": "BG", "text": "Коледна ваканция"},
    {"language": "DE", "text": "Weihnachtsferien"},
    {"language": "EN", "text": "Christmas holidays"}
  ],
  "regionalScope": "National",
  "temporalScope": "FullDay",
  "nationwide": true,
  "comment": [
    {"language": "BG", "text": "I-XI клас"}
  ]
}
```

**Key Response Fields:**
- `startDate` / `endDate` - ISO date strings (date range for vacation period)
- `type` - "School" for school holidays
- `name[]` - Multilingual array (BG text available)
- `comment[]` - Optional grade level info (e.g., "I-XI клас", "XII клас")
- `nationwide` - Boolean indicating if applies nationally

**Observed Patterns (2026 Bulgaria):**
- Multiple overlapping entries for different grade levels (e.g., separate summer vacation dates for grades 1-3, 4-6, 7-11, 12)
- Single-day events (e.g., "Свободен от училище" on 2026-03-02)
- Date ranges spanning multiple weeks (e.g., "Коледна ваканция" 2025-12-24 to 2026-01-04)

**Implementation Notes:**
- Use same fetchWithRetry pattern as public holidays (already in codebase)
- Extract BG text from name array: `name.find(n => n.language === "BG")?.text`
- Handle date ranges: need to display as "4 Април – 13 Април – Пролетна ваканция"
- Consider merging overlapping grade-specific entries or showing grade info in UI
- No authentication required (same as public holidays API)

---

### 2. Current Holiday Fetch Implementation

**File:** `/home/nikolaymih11/webstormprojects/pochivnirabotnidni/lib/holidays/fetch.ts`

**Current Architecture:**
```typescript
export async function getHolidays(year: number): Promise<Holiday[]>
```

**Data Flow:**
1. Layer 1: Try OpenHolidays API with fetchWithRetry (3 attempts with exponential backoff)
2. Layer 2: Static fallback JSON (`data/holidays-{year}-fallback.json`)
3. 24-hour cache via Next.js `{ next: { revalidate: 86400 } }`

**API URL Pattern:**
```
https://openholidaysapi.org/PublicHolidays?countryIsoCode=BG&validFrom=2026-01-01&validTo=2026-12-31
```

**Processing:**
- Maps API response to Holiday interface
- Uses `startDate` directly (already in YYYY-MM-DD format) - CRITICAL: never use toISOString() per Phase 1.1 decision
- Extracts Bulgarian text from multilingual name array

**Holiday Type Interface:**
```typescript
export interface Holiday {
  name: string;
  date: string; // ISO date string (YYYY-MM-DD)
  type: HolidayType;
}

export type HolidayType = 'Public Holiday' | 'National Holiday' | 'Observance';
```

**Logging:**
- Extensive console logging for debugging (raw API response, processed holidays, Dec 31st check)
- Logs success/failure for both API and fallback layers

**Key Decision from STATE.md (TECH-07):**
- Store dates as ISO strings (YYYY-MM-DD) without time component
- Use parseISO() for date parsing (Safari-safe)
- NEVER use new Date(string) - causes Safari bugs
- NEVER use .toISOString() for date-only values - causes timezone shifts

**Implications for School Holidays:**
- Need parallel `getSchoolHolidays(year)` function
- Follow same retry + fallback pattern
- Create SchoolHoliday interface with startDate/endDate (not single date)
- Extract BG text same way as public holidays
- Same 24hr cache strategy

---

### 3. Current page.tsx Layout Structure

**File:** `/home/nikolaymih11/webstormprojects/pochivnirabotnidni/app/page.tsx`

**Current Layout:**

**Mobile (< lg breakpoint):**
```
<div className="lg:hidden">
  <div className="p-4">
    <div> {/* Header with title and auth */}
      <h1>Празнични, неучебни и неработни дни през {currentYear} година.</h1>
      <AuthHeader />
    </div>
    <p>Календар с български празници...</p>
    <Legend />
    <VacationSummary />
  </div>
  <div className="p-4">
    <FullYearCalendarWrapper />
  </div>
</div>
```

**Desktop (>= lg breakpoint):**
```
<div className="hidden lg:flex gap-6">
  {/* Left: Scrollable calendar */}
  <div className="flex-1 overflow-y-auto p-4">
    <div> {/* Header with title and auth */}
      <h1>Празнични, неучебни и неработни дни през {currentYear} година.</h1>
      <p>Календар с български празници...</p>
    </div>
    <AuthHeader />
    <FullYearCalendarWrapper />
  </div>

  {/* Right: Sticky sidebar */}
  <div className="w-80 sticky top-0 h-screen overflow-y-auto p-4">
    <Legend />
    <VacationSummary />
  </div>
</div>
```

**Repeated Text (needs extraction to constants):**
1. Page title: "Празнични, неучебни и неработни дни през {currentYear} година."
2. Page description: "Календар с български празници и работни дни за планиране на вашата година. Запознайте се с официалните празници, неучебните и неработните дni. Разберете кога се падат почивните дни и как най-ефективно да комбинирате отпуск с празници за по-дълги почивки."

**Current Responsive Breakpoint:**
- `lg:` breakpoint (Tailwind default: 1024px)
- Single breakpoint toggles between mobile stack and desktop two-column

**Component Arrangement:**
- AuthHeader is inside main content area (not header element)
- VacationSummary is in right sidebar on desktop, top of content on mobile
- Legend above VacationSummary in sidebar
- No dedicated year selector component yet

**Data Fetching:**
```typescript
const currentYear = getYear(new Date());
const [prevYearHolidays, currentYearHolidays, nextYearHolidays] = await Promise.all([
  getHolidays(currentYear - 1),
  getHolidays(currentYear),
  getHolidays(currentYear + 1),
]);
const holidays = [...prevYearHolidays, ...currentYearHolidays, ...nextYearHolidays];
```
- Fetches 3 years of holidays (prev, current, next) for year-spanning weeks
- Server-side async component

---

### 4. Current layout.tsx Header Structure

**File:** `/home/nikolaymih11/webstormprojects/pochivnirabotnidni/app/layout.tsx`

**Current Metadata:**
```typescript
export const metadata: Metadata = {
  title: "Почивни Работни Дни - Календар с Български Празници 2026",
  description: "Преглед на българските официални празници и планиране на вашите дни за отпуск с интерактивен календар за 2026",
  manifest: "/manifest.json",
  themeColor: "#C68E17", // Caramel from Coffee theme
  appleWebApp: {
    capable: true,
    statusBarStyle: "default",
    title: "Почивни Дни",
  },
};
```

**Issues Identified:**
- Hardcoded "2026" in both title and description
- Needs dynamic year substitution
- Description is different from page.tsx description (inconsistent)

**Layout Structure:**
```tsx
<html lang="bg">
  <body>
    <AuthProvider>
      {children}
    </AuthProvider>
    <Toaster />
    <NetworkStatus />
    <ServiceWorkerRegistration />
  </body>
</html>
```

**No Header Element:**
- Layout.tsx has NO header/nav component
- AuthHeader is rendered inside page.tsx content area
- This is correct per phase requirements: header should ONLY contain auth UI

**Implications:**
- Need to make metadata dynamic (generateMetadata function)
- Year needs to come from URL params or current date
- Extract shared text to constants for consistency

---

### 5. MonthGrid Component - Day Rendering & Tooltip Behavior

**File:** `/home/nikolaymih11/webstormprojects/pochivnirabotnidni/components/MonthGrid.tsx`

**Component Type:** Client Component (converted in Phase 5.1 for pointer events)

**Current Pointer Event Handling:**
```typescript
onPointerDown={handlePointerDownCell}
onPointerEnter={handlePointerEnterCell}
onPointerUp={handlePointerUpCell}
```

**Touch Targets:**
- Min 44px × 44px (WCAG 2.5.5 compliant)
- Applied via: `min-w-[44px] min-h-[44px]`
- Flex centering maintains compact visual appearance

**Day Cell Styling Priority (highest to lowest):**
1. Highlighted (150ms flash on tap) - `bg-highlight` (oat-milk)
2. Holiday - `bg-holiday-bg text-holiday font-semibold`
3. Bridge - `bg-bridge-bg text-bridge`
4. Vacation - `bg-vacation-bg text-vacation`
5. Weekend - `bg-weekend-bg text-weekend-text`
6. Workday - `hover:bg-cream`

**Touch Interaction:**
- `touch-action: none` applied to clickable cells (prevents scroll/zoom during drag)
- Brief highlight flash (150ms) on tap using state + timer
- Cleanup with useEffect to prevent memory leaks

**No Tooltip Implementation in MonthGrid:**
- MonthGrid does NOT render tooltips
- Only renders day numbers and background colors
- DayTooltip is separate component (not currently integrated)

**Holiday Display:**
- Holidays are non-clickable: `const isClickable = !isHoliday;`
- Holiday cells show only day number with holiday background color
- No visual indicator for tooltip availability

**Current Issue:**
- No tooltip rendered in MonthGrid cells
- DayTooltip component exists but not integrated into MonthGrid

---

### 6. DayTooltip Component - Current Implementation

**File:** `/home/nikolaymih11/webstormprojects/pochivnirabotnidni/components/DayTooltip.tsx`

**Component Type:** Client Component

**Current Trigger Mechanism:**
```tsx
<button
  onMouseEnter={() => setIsVisible(true)}
  onMouseLeave={() => setIsVisible(false)}
  onClick={(e) => {
    e.stopPropagation();
    setIsVisible(!isVisible);
  }}
  className="..."
  aria-label="Подробности за празника"
>
  i
</button>
```

**Interaction Modes:**
- Desktop: `onMouseEnter` / `onMouseLeave` for hover
- Mobile: `onClick` toggles visibility (conflicts with Phase 5.2 requirement)

**Visual Design:**
- Info button with "i" icon
- Positioned absolutely: `absolute top-1 right-1`
- Tooltip popup: `absolute right-0 top-7 z-10 w-48`
- Dark background (espresso) with light text (foam)

**Tooltip Content:**
```tsx
<div className="font-bold mb-1">{holiday.name}</div>
<div className="text-xs opacity-80 mb-1">
  {format(parseDate(holiday.date), 'MMM d, yyyy', { locale: bg })}
</div>
<div className="text-xs opacity-80">{holiday.type}</div>
```

**Problems Identified:**
1. **Mobile Conflict:** onClick toggles tooltip BUT mobile tap should be for vacation selection only
2. **Not Integrated:** DayTooltip not rendered in MonthGrid component
3. **Pointer Event Conflict:** MonthGrid uses pointer events for drag selection, would block tooltip interactions

**Phase 5.2 Requirements:**
- Tooltips should be DESKTOP HOVER ONLY
- NO tooltips on mobile (mobile uses left sidebar for holiday info instead)
- Need to add tooltip to MonthGrid holiday cells
- Must not interfere with pointer event drag selection

**Implementation Path:**
- Use CSS media query to hide tooltip button on mobile
- OR use `window.matchMedia` to detect desktop vs mobile
- Render DayTooltip only on holiday cells
- Position info button so it doesn't block day number
- Ensure tooltip doesn't interfere with pointer events on non-holiday cells

---

### 7. Legend Component - Current Entries

**File:** `/home/nikolaymih11/webstormprojects/pochivnirabotnidni/components/Legend.tsx`

**Current Entries:**
1. **Официален празник** - `bg-cinnamon` (solid cinnamon)
2. **Уикенд** - `bg-cream border border-latte`
3. **Днес** - `border-2 border-caramel`
4. **Лична почивка** - `bg-vacation-bg border border-latte`

**Missing Entries (per Phase 5.2):**
1. **Неучебни дни / Ученически ваканции** - NEW (teal/blue-green color needed)
2. **Предложение за почивка** - Bridge day suggestions (honey color exists but not in legend)

**Color Tokens (from globals.css):**
```css
--color-cinnamon: #B5651D;
--color-holiday-bg: #F5E6D8; /* Light cinnamon */
--color-honey: #EB9605;
--color-bridge-bg: #FDF3DC; /* Light honey */
--color-caramel: #C68E17;
--color-vacation-bg: #F9EED4; /* Light caramel */
--color-cream: #F5F0E8;
--color-weekend-text: #8B6B5D;
```

**Issue Identified (from Phase 5.2 context):**
- "Holiday color mismatch fix" - Legend shows solid cinnamon but calendar shows holiday-bg (light cinnamon)
- Phase 5.2 requires: "Legend color and calendar cell color for Официален празник must be identical"

**Current Mismatch:**
- Legend: `bg-cinnamon` (#B5651D - solid)
- MonthGrid: `bg-holiday-bg` (#F5E6D8 - light)
- These are NOT the same color

**Fix Required:**
- Use solid cinnamon background in BOTH legend and MonthGrid holiday cells
- Use white/light text for readability on dark background
- Remove holiday-bg variant entirely OR only use it for subtle highlights

**New Color Needed:**
- Teal/blue-green for school holidays (must fit Coffee theme palette)
- Suggestion: `--color-teal: #4A9B8E` (muted teal matching coffee warmth)
- Light variant: `--color-school-bg: #E5F3F0` (very light teal)

---

### 8. FullYearCalendar & Wrapper - Layout Structure

**FullYearCalendar.tsx:**
```tsx
<div className="container mx-auto px-4 py-6">
  <h1 className="text-3xl font-bold mb-6">{year}</h1>
  <div className="flex flex-col gap-4">
    {Array.from({ length: 12 }, (_, monthIndex) => (
      <MonthGrid key={monthIndex} ... />
    ))}
  </div>
</div>
```

**Current Layout:**
- Single-column vertical scroll (12 months stacked)
- Year header at top (large title)
- 4px gap between month grids

**FullYearCalendarWrapper.tsx:**
- Client Component wrapper
- Bridges VacationContext to FullYearCalendar
- Manages drag selection state (isDragging, dragMode, dragStartDate)
- Document-level pointerup listener for drag-end detection

**No Dimensional Constraints:**
- MonthGrid has no max-width or max-height
- Scales based on content and parent container
- Border box with padding: `border border-latte rounded-lg p-3`

**Phase 5.2 Requirements:**
- Calendar per-month cell: max-width 650px, max-height 320px
- Need to add these constraints to MonthGrid styling
- Should scale down on smaller screens (responsive)

**Year Header:**
- Currently inside FullYearCalendar component
- Phase 5.2 requires: year selector above calendar, horizontally centered
- Needs to become interactive selector (not just display)

---

### 9. Coffee Theme Tokens - Current Colors

**File:** `/home/nikolaymih11/webstormprojects/pochivnirabotnidni/app/globals.css`

**Base Colors:**
```css
--color-espresso: #2C1810;      /* Darkest - headings */
--color-dark-roast: #3D251E;
--color-mocha: #5D3A2E;
--color-coffee: #6F4E37;        /* Labels */
--color-cappuccino: #8B6B5D;    /* Secondary text */
--color-latte: #C4A484;         /* Borders */
--color-oat-milk: #D4C4A8;      /* Disabled */
--color-cream: #F5F0E8;         /* Weekends */
--color-foam: #FAF8F5;          /* Background */
```

**Accent Colors:**
```css
--color-caramel: #C68E17;       /* Vacation */
--color-cinnamon: #B5651D;      /* Holidays */
--color-honey: #EB9605;         /* Bridge days */
```

**Semantic Colors:**
```css
--color-success: #5D8A4E;
--color-warning: #C68E17;
--color-error: #B54D4D;
--color-info: #5D7A8A;
```

**Calendar Aliases:**
```css
--color-holiday: #B5651D;          /* Same as cinnamon */
--color-holiday-bg: #F5E6D8;       /* Light cinnamon */
--color-bridge: #EB9605;           /* Same as honey */
--color-bridge-bg: #FDF3DC;        /* Light honey */
--color-vacation: #C68E17;         /* Same as caramel */
--color-vacation-bg: #F9EED4;      /* Light caramel */
--color-weekend-bg: #F5F0E8;       /* Same as cream */
--color-weekend-text: #8B6B5D;     /* Same as cappuccino */
--color-today-ring: #C68E17;       /* Same as caramel */
--color-highlight: #D4C4A8;        /* Same as oat-milk (tap flash) */
```

**Missing Colors (for Phase 5.2):**
1. School holiday primary color (teal/blue-green)
2. School holiday light background variant

**Recommended Additions:**
```css
--color-teal: #4A9B8E;            /* School holidays */
--color-school-bg: #E5F3F0;       /* Light teal background */
```

**Rationale:**
- Teal (#4A9B8E) is muted and earthy, fits Coffee theme warmth
- Not too saturated (avoids neon blue)
- Distinct from existing caramel/cinnamon/honey
- Light variant (#E5F3F0) provides subtle background like other -bg colors

---

### 10. Bridge Day Logic - Current Implementation

**File:** `/home/nikolaymih11/webstormprojects/pochivnirabotnidni/lib/calendar/bridgeDays.ts`

**Algorithm:** Full-week bridge detection

**Rules:**
1. For each weekday holiday (Mon-Fri), suggest ALL other workdays in that work week
2. Skip weekend holidays (Sat/Sun) - no suggestions
3. Each suggestion uses reason: 'full-week' and daysOff: 5
4. Skip dates that are already holidays
5. Prevent duplicates using Set

**BridgeDay Interface:**
```typescript
export interface BridgeDay {
  date: string; // ISO format yyyy-MM-dd
  reason: 'holiday-after' | 'holiday-before' | 'cluster-connector' | 'full-week';
  relatedHoliday: string; // Holiday name
  daysOff: number; // Total consecutive days
}
```

**Weekend Holiday Handling:**
```typescript
const dayOfWeek = getISODay(holidayDate); // 1=Monday, 7=Sunday

// Skip weekend holidays (Saturday=6, Sunday=7)
if (dayOfWeek === 6 || dayOfWeek === 7) {
  continue;
}
```

**Current Behavior:**
- Weekend holidays (Sat/Sun) are completely ignored
- No bridge day suggestions generated for weekend holidays
- No compensatory Monday logic

**Phase 5.2 Requirement:**
- "When an official holiday falls on Saturday or Sunday: show the holiday color on Monday ONLY (not on the weekend day)"
- "Bulgaria observes the following Monday as the compensatory day off"
- "The weekend day (Sat/Sun) stays as normal weekend color (cream)"
- "Monday tooltip: 'Нова година (почивен ден)' — holiday name + note it's a substitute day"

**Implementation Gap:**
- Bridge day logic does NOT handle compensatory Mondays
- This is a holiday TRANSFER logic, not a bridge day suggestion
- Needs separate handling in holiday display logic, not bridge day detection

**Solution Path:**
1. Check if holiday falls on Sat/Sun
2. If yes, calculate following Monday date
3. Display holiday on Monday instead of weekend day
4. Tooltip shows: "{holiday name} (почивен ден)"
5. Implement in MonthGrid rendering logic, NOT bridgeDays.ts

---

### 11. Weekend Holiday Handling - Current State

**Searched For:** substitute, compensatory, observ, transfer, weekend holiday handling

**Found:** No existing implementation

**Current Behavior:**
- Holidays display on their actual date (including Sat/Sun)
- No transfer logic to following Monday
- MonthGrid uses simple date matching: `isHoliday = holidayDates.has(dateStr)`

**Where Weekend Detection Happens:**
```typescript
// MonthGrid.tsx
const dayOfWeek = (firstDayOfWeek + index) % 7;
const isWeekend = dayOfWeek === 5 || dayOfWeek === 6; // 0=Mon, 6=Sun
```

**Missing Logic:**
1. Detect if holiday falls on Saturday (dayOfWeek === 5)
2. Detect if holiday falls on Sunday (dayOfWeek === 6)
3. Calculate following Monday date
4. Transfer holiday display to Monday
5. Keep Saturday/Sunday as normal weekend color
6. Add substitute day indicator to tooltip

**Implementation Approach:**

**Option A: Pre-process holidays in FullYearCalendar**
- Before passing to MonthGrid, transform weekend holidays to Monday equivalents
- Create new Holiday objects with Monday dates
- Add `isSubstitute: true` flag
- Pros: MonthGrid stays simple
- Cons: Modifies holiday data

**Option B: Handle in MonthGrid rendering**
- Keep original holiday data unchanged
- During rendering, check if current day is Monday after weekend holiday
- Display holiday color on Monday, not weekend
- Pros: Preserves original holiday data
- Cons: More complex MonthGrid logic

**Recommendation:** Option B
- Preserves API data integrity
- Keeps holiday source of truth accurate
- Rendering logic is where display decisions belong

---

### 12. Year Selector - Current State

**Searched For:** year selector, select year, useYear, YearSelector component

**Found:** No dedicated year selector component exists

**Current Year Handling:**
```typescript
// page.tsx
const currentYear = getYear(new Date()); // Uses date-fns
```

**Year is Static:**
- Calculated once on page load
- No user interaction to change year
- No state management for selected year

**Phase 5.2 Requirements:**
- "Year selector moves to above the calendar, horizontally centered"
- Needs to become interactive
- User can select different years
- Calendar re-renders with new year data

**Implementation Needed:**
1. Create YearSelector component (Client Component for interactivity)
2. State management: `useState<number>(currentYear)`
3. UI: Dropdown or prev/next buttons
4. Fetch holidays for selected year
5. Position: above calendar, centered

**Considerations:**
- Current page.tsx is async Server Component (fetches holidays)
- Year selector needs client interactivity
- May need to move holiday fetching to client OR use route params

**Options:**

**Option A: URL-based year selection**
- Use route params: `/[year]` or query params `?year=2026`
- Server Component can read params
- Navigation changes URL
- Pros: Shareable URLs, server-side rendering
- Cons: Full page reload on year change

**Option B: Client-side year state**
- useState in client component
- Fetch holidays client-side on year change
- Pros: Instant year switching
- Cons: Loses server-side rendering benefits

**Recommendation:** Option A for SEO and shareable URLs

---

## Implementation Recommendations

### 1. School Holidays Integration

**New Function:**
```typescript
// lib/holidays/schoolHolidays.ts
export interface SchoolHoliday {
  name: string;
  startDate: string; // ISO date string
  endDate: string;   // ISO date string
  type: 'School';
  gradeLevel?: string; // e.g., "I-XI клас"
}

export async function getSchoolHolidays(year: number): Promise<SchoolHoliday[]>
```

**Fetch Pattern:**
- Same retry + fallback as public holidays
- API: `https://openholidaysapi.org/SchoolHolidays?countryIsoCode=BG&validFrom=...`
- Extract BG text from multilingual name array
- Handle date ranges (need to generate all dates between startDate and endDate)
- Optional: merge overlapping grade-specific entries

**Display Format:**
- Left sidebar: "4 Април – 13 Април – Пролетна ваканция"
- Calendar cells: show teal color for all dates in range
- Legend: "Неучебни дни / Ученически ваканции" with teal color

---

### 2. Layout Restructuring

**Desktop (>= lg):**
```
┌─────────────────────────────────────────────────┐
│ Header: <h1> + <AuthHeader>                    │
├──────────┬──────────────────────┬───────────────┤
│ Left     │ Main Content         │ Right Sidebar │
│ Sidebar  │ - Year Selector      │ - Legend      │
│ - Hols   │ - Title/Description  │ - Summary     │
│ - School │ - Calendar (12 mos)  │               │
└──────────┴──────────────────────┴───────────────┘
```

**Mobile:**
```
┌─────────────────────┐
│ Header (title+auth) │
├─────────────────────┤
│ Right Sidebar       │
│ - Legend + Summary  │
├─────────────────────┤
│ Left Sidebar        │
│ - Holidays          │
│ - School Vacations  │
├─────────────────────┤
│ Year Selector       │
├─────────────────────┤
│ Calendar            │
└─────────────────────┘
```

**Key Changes:**
1. Add left sidebar component (new)
2. Move AuthHeader to actual header element
3. Add year selector above calendar
4. Align sidebars with first calendar month (not page top)
5. Make sidebars sticky on desktop

---

### 3. Text Constants Extraction

**New File:** `lib/constants.ts`

```typescript
export const APP_TEXT = {
  PAGE_TITLE: (year: number) => `Празнични, неучебни и неработни дни през ${year} година`,
  META_DESCRIPTION: (year: number) => `Запознайте се с официалните празници, неучебните и неработните дни за ${year} година. Разберете кога се падат почивните дни и как най-ефективно да комбинирате отпуск с празници за по-дълги почивки.`,
  PAGE_SUBTITLE: 'Календар с български празници и работни дни за планиране на вашата година.',

  LEGEND: {
    OFFICIAL_HOLIDAY: 'Официален празник',
    WEEKEND: 'Уикенд',
    TODAY: 'Днес',
    VACATION: 'Лична почивка',
    BRIDGE: 'Предложение за почивка',
    SCHOOL_HOLIDAY: 'Неучебни дни / Ученически ваканции',
  },

  // ... more constants
} as const;
```

**Usage:**
- Import in page.tsx, layout.tsx, Legend.tsx, tests
- Dynamic year substitution via function calls
- Type-safe with TypeScript const assertion

---

### 4. Weekend Holiday Transfer Logic

**In MonthGrid.tsx:**

```typescript
// Detect if today is Monday after weekend holiday
const isMonday = dayOfWeek === 0; // Monday in our 0-6 system

if (isMonday && !isHoliday) {
  // Check if Saturday or Sunday had a holiday
  const saturday = subDays(date, 2); // 2 days back
  const sunday = subDays(date, 1);   // 1 day back

  const saturdayHoliday = holidays.find(h => h.date === format(saturday, 'yyyy-MM-dd'));
  const sundayHoliday = holidays.find(h => h.date === format(sunday, 'yyyy-MM-dd'));

  const transferredHoliday = sundayHoliday || saturdayHoliday;

  if (transferredHoliday) {
    // Display as holiday on Monday
    // Tooltip: "{holiday.name} (почивен ден)"
  }
}
```

**Tooltip Modification:**
- Add `isSubstitute` flag
- Show "(почивен ден)" suffix on substitute days
- Keep weekend days as normal weekend color

---

### 5. Tooltip Desktop-Only Implementation

**Approach:** CSS media query to hide on mobile

```tsx
// MonthGrid.tsx - only render tooltip on holiday cells
{isHoliday && (
  <div className="hidden lg:block">
    <DayTooltip holiday={holidayObject} />
  </div>
)}
```

**Tailwind Breakpoint:**
- `hidden` on mobile (default)
- `lg:block` on desktop (>= 1024px)

**No Pointer Event Conflict:**
- Holiday cells are already non-clickable: `isClickable = !isHoliday`
- Tooltip button has its own click handler with stopPropagation
- Desktop hover works via onMouseEnter/onMouseLeave
- Mobile users see holiday info in left sidebar instead

---

### 6. Legend Updates

**Add Missing Entries:**

```tsx
{/* Bridge Day Suggestion */}
<div className="flex items-center gap-2">
  <div className="w-6 h-6 bg-bridge-bg border border-latte rounded"></div>
  <span className="text-sm">Предложение за почивка</span>
</div>

{/* School Holidays */}
<div className="flex items-center gap-2">
  <div className="w-6 h-6 bg-school-bg border border-latte rounded"></div>
  <span className="text-sm">Неучебни дни / Ученически ваканции</span>
</div>
```

**Fix Color Mismatch:**

Option A: Use solid cinnamon for both
```tsx
<div className="w-6 h-6 bg-cinnamon rounded"></div> {/* Legend */}
// MonthGrid: bg-cinnamon text-white (instead of bg-holiday-bg)
```

Option B: Use light background for both
```tsx
<div className="w-6 h-6 bg-holiday-bg border border-latte rounded"></div>
// Keep MonthGrid as-is
```

**Recommendation:** Option A (solid cinnamon in both)
- More visually distinct from weekends
- Matches phase requirement for "solid color"
- White text on cinnamon background is readable

---

### 7. Calendar Sizing Constraints

**Add to MonthGrid.tsx:**

```tsx
<div className="border border-latte rounded-lg p-3 bg-white shadow-sm max-w-[650px] max-h-[320px]">
  {/* Existing month grid content */}
</div>
```

**Responsive Scaling:**
- Max constraints prevent oversized calendars on large screens
- Flexbox/Grid naturally scales down on smaller screens
- Mobile: remove max constraints or use smaller values

**Consider:**
- 650px max-width per month may be too wide for 12 stacked months on desktop
- Might need different constraints for single-column vs multi-column layouts

---

### 8. Day Type Priority System

**Update MonthGrid.tsx Priority:**

Current:
```
Holiday > Bridge > Vacation > Weekend > Workday
```

New (per Phase 5.2):
```
Holiday > Vacation > School Holiday > Bridge > Weekend
```

**Implementation:**
```typescript
// MonthGrid.tsx styling logic
const dayClasses = [
  // ... base classes
  isHighlighted && 'bg-highlight',
  !isHighlighted && isHoliday && 'bg-cinnamon text-white font-semibold',
  !isHighlighted && !isHoliday && isVacation && 'bg-vacation-bg text-vacation',
  !isHighlighted && !isHoliday && !isVacation && isSchoolHoliday && 'bg-school-bg text-teal',
  !isHighlighted && !isHoliday && !isVacation && !isSchoolHoliday && isBridge && 'bg-bridge-bg text-bridge',
  // ... weekend and workday
];
```

**Vacation + School Holiday Overlap:**
- Phase 5.2: "show both (split cell or small indicator)"
- Recommendation: Small school holiday indicator dot in corner
- Vacation background stays primary
- Avoids complex split-cell rendering

---

## Key Decisions Needed During Planning

1. **School Holiday Date Range Handling:**
   - Generate individual dates for each day in range?
   - Or store ranges and check if current date falls within?
   - Performance implications for Set-based lookups

2. **Grade Level Display:**
   - Show grade info in left sidebar list? (e.g., "Лятна ваканция (I-III клас)")
   - Or merge overlapping entries into single "Лятна ваканция" with broader date range?
   - User value: do parents care about specific grade levels?

3. **Year Selector Implementation:**
   - URL-based (route params) vs client state?
   - Dropdown vs prev/next buttons?
   - Year range limits (2020-2030)?

4. **Left Sidebar Content Order:**
   - Official holidays first, then school holidays? (per context)
   - Sort by date within each section?
   - Separate visual sections or single list?

5. **Sidebar Sticky Behavior:**
   - Both sidebars sticky? Or only right sidebar?
   - Align with first calendar month - implementation approach?
   - CSS position sticky with top offset?

6. **School Holiday + Vacation Overlap:**
   - Small dot indicator? Border? Icon?
   - Which visual approach is clearest?
   - Performance cost of additional rendering logic?

7. **Weekend Holiday Transfer:**
   - Transfer Saturday holidays to Monday?
   - Transfer Sunday holidays to Monday?
   - Both? (likely yes per Bulgarian labor law)
   - API provides this info or need to implement logic?

8. **Color Mismatch Fix:**
   - Solid cinnamon (dark) or light cinnamon background?
   - Text color on dark background (white/cream)?
   - Impact on overall calendar readability?

---

## Files to Create

1. `lib/holidays/schoolHolidays.ts` - School holiday fetch logic
2. `lib/constants.ts` - Shared text constants
3. `components/LeftSidebar.tsx` - Holiday and school vacation list
4. `components/YearSelector.tsx` - Interactive year selection
5. `data/school-holidays-{year}-fallback.json` - Static fallback for school holidays

---

## Files to Modify

1. `app/page.tsx` - Layout restructuring (three-column desktop, reorder mobile)
2. `app/layout.tsx` - Dynamic metadata with year substitution
3. `components/MonthGrid.tsx` - Add max dimensions, fix holiday color, weekend transfer, school holidays, integrate tooltip
4. `components/Legend.tsx` - Add bridge day and school holiday entries, fix color mismatch
5. `components/DayTooltip.tsx` - Desktop-only behavior (hide on mobile)
6. `components/FullYearCalendar.tsx` - Remove year header (moves to separate selector)
7. `components/VacationSummary.tsx` - No changes (stays in right sidebar)
8. `components/AuthHeader.tsx` - May need header element wrapper
9. `app/globals.css` - Add teal color tokens for school holidays
10. `lib/holidays/types.ts` - Add SchoolHoliday interface

---

## External Resources

- OpenHolidays API Documentation: https://www.openholidaysapi.org/en/
- OpenHolidays API GitHub (Data Repository): https://github.com/openpotato/openholidaysapi.data
- PublicAPI Entry: https://publicapi.dev/open-holidays-api

---

## Open Questions

1. **Bulgarian Labor Law:** Do weekend holidays officially transfer to following Monday in Bulgaria? (Assumption: yes, but needs validation)

2. **School Holiday UX:** Should overlapping grade-specific vacations be merged or shown separately? (e.g., summer vacation has 4 different entries for different grades)

3. **Mobile Sidebar Order:** Context says "right sidebar → left sidebar → calendar" - is this optimal? Would "left sidebar → right sidebar → calendar" be more logical (holidays first, then personal vacation summary)?

4. **Year Selector Persistence:** Should selected year persist in localStorage? Or only in URL?

5. **SEO for Year Pages:** If using URL-based year selection, need separate pages for each year (2024, 2025, 2026, etc.) for SEO?

6. **Sidebar Alignment with First Month:** "Align with first month" - does this mean top of sidebar aligns with top of January calendar? Or with top of first visible month when scrolling?

---

**Research Complete:** 2026-02-07
**Next Step:** Create planning documents based on research findings
