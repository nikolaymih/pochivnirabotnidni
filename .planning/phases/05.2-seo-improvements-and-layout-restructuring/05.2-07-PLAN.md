---
phase: 05.2-seo-improvements-and-layout-restructuring
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - components/Legend.tsx
  - app/globals.css
  - components/DayTooltip.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Legend holiday swatch is a plain colored square with no text inside"
    - "Vacation color is clearly distinguishable from bridge color in both legend and calendar"
    - "On mobile, holiday cells show a small exclamation icon that toggles tooltip on tap"
    - "Desktop tooltip behavior unchanged (hover to show)"
  artifacts:
    - path: "components/Legend.tsx"
      provides: "Holiday swatch without П text"
      contains: "bg-cinnamon"
    - path: "app/globals.css"
      provides: "Updated vacation color tokens"
      contains: "--color-vacation"
    - path: "components/DayTooltip.tsx"
      provides: "Mobile click-toggle tooltip with exclamation icon"
      contains: "stopPropagation"
  key_links:
    - from: "app/globals.css"
      to: "components/Legend.tsx"
      via: "vacation-bg token"
      pattern: "bg-vacation-bg"
    - from: "components/DayTooltip.tsx"
      to: "components/MonthGrid.tsx"
      via: "rendered inside day cells"
      pattern: "DayTooltip"
---

<objective>
Fix Legend swatch (remove "П" text), update vacation color to be brighter and more distinguishable from bridge color, and add mobile-accessible tooltip with click-toggle exclamation icon.

Purpose: Close UAT gaps T7 (Legend & vacation color) and T11 (mobile tooltip). Users need to visually differentiate vacation from bridge days, and mobile users need access to holiday info without interfering with drag selection.
Output: Updated Legend.tsx, globals.css color tokens, and DayTooltip.tsx with mobile support.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@components/Legend.tsx
@app/globals.css
@components/DayTooltip.tsx
@components/MonthGrid.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Legend swatch and vacation color tokens</name>
  <files>components/Legend.tsx, app/globals.css</files>
  <action>
  **Legend.tsx changes:**
  - Line 8: Remove the "П" text from the holiday swatch. Change from:
    `<div className="w-6 h-6 bg-cinnamon text-white text-xs font-semibold flex items-center justify-center rounded">П</div>`
    to:
    `<div className="w-6 h-6 bg-cinnamon rounded"></div>`
  - The swatch should be a plain solid cinnamon-colored square with no text.

  **globals.css changes:**
  - Change the vacation color to be brighter and more saturated, clearly distinct from bridge (#EB9605/honey).
  - The vacation color should match the brightness level of cinnamon (#B5651D) but in a different hue.
  - Use a saturated green-gold or teal-adjacent warm tone. Recommended: `#2E8B57` (sea green) for --color-vacation, `#D4EDDA` for --color-vacation-bg. This gives strong contrast against honey/bridge while fitting the earthy Coffee theme.
  - Alternative if green feels wrong: a rich saturated blue like `#4A7FB5` with bg `#D6E5F3`. The key requirement is CLEARLY DIFFERENT from honey (#EB9605).
  - Update these lines in globals.css:
    - `--color-vacation: #2E8B57;` (was #C68E17)
    - `--color-vacation-bg: #D4EDDA;` (was #F9EED4)
  - Do NOT change --color-caramel (#C68E17) — that's the accent/interactive color, not vacation display.

  **Why this approach:** The user explicitly said "Лична почивка needs to be brighter/more saturated — same brightness level as Официален празник (cinnamon)". The current vacation (#C68E17) and bridge (#EB9605) are both amber/golden tones that are too similar. Moving vacation to a distinct hue solves this permanently.
  </action>
  <verify>
  - Open Legend.tsx and confirm no "П" text exists in the holiday swatch div
  - Open globals.css and confirm --color-vacation is NOT #C68E17
  - Run `npm run build` to verify no build errors
  </verify>
  <done>
  - Holiday legend swatch is a plain solid cinnamon square with no text
  - Vacation color is a distinct hue from bridge color, visible in both legend swatches and calendar cells
  </done>
</task>

<task type="auto">
  <name>Task 2: Add mobile tooltip with exclamation icon and click-toggle</name>
  <files>components/DayTooltip.tsx</files>
  <action>
  Rewrite DayTooltip.tsx to support BOTH desktop hover AND mobile click-toggle:

  **Desktop behavior (unchanged):**
  - "i" button visible on lg: screens
  - onMouseEnter/onMouseLeave shows/hides tooltip

  **Mobile behavior (NEW):**
  - Show a small "!" icon at top-right corner of holiday cells on mobile (visible below lg breakpoint)
  - The icon should be styled: `text-[10px] bg-cinnamon/70 text-white rounded-full w-3.5 h-3.5 flex items-center justify-center font-bold`
  - onClick handler on the "!" icon:
    1. Call `e.stopPropagation()` to prevent drag selection from triggering
    2. Call `e.preventDefault()` to prevent any default behavior
    3. Toggle a `showMobileTooltip` boolean state
  - When `showMobileTooltip` is true, show the same tooltip content as desktop (holiday name, date, substitute info)
  - Tooltip positioned: `absolute right-0 top-5 z-10 w-48 p-3 bg-espresso text-foam text-sm rounded shadow-lg`

  **Structure:**
  ```tsx
  'use client';
  import { useState } from 'react';
  import { format } from 'date-fns';
  import { bg } from 'date-fns/locale';
  import { parseDate } from '@/lib/calendar/dates';
  import type { Holiday } from '@/lib/holidays/types';

  interface DayTooltipProps {
    holiday: Holiday;
    isSubstitute?: boolean;
  }

  export default function DayTooltip({ holiday, isSubstitute = false }: DayTooltipProps) {
    const [isDesktopVisible, setIsDesktopVisible] = useState(false);
    const [isMobileVisible, setIsMobileVisible] = useState(false);

    const displayName = isSubstitute
      ? `${holiday.name} (почивен ден)`
      : holiday.name;

    const tooltipContent = (
      <div className="absolute right-0 top-5 z-10 w-48 p-3 bg-espresso text-foam text-sm rounded shadow-lg">
        <div className="font-bold mb-1">{displayName}</div>
        <div className="text-xs opacity-80 mb-1">
          {format(parseDate(holiday.date), 'd MMMM yyyy', { locale: bg })}
        </div>
      </div>
    );

    return (
      <>
        {/* Desktop: hover icon (hidden on mobile) */}
        <div className="hidden lg:block absolute top-0 right-0">
          <button
            onMouseEnter={() => setIsDesktopVisible(true)}
            onMouseLeave={() => setIsDesktopVisible(false)}
            className="text-xs bg-foam/80 text-espresso rounded-full w-4 h-4 flex items-center justify-center font-bold hover:bg-cream transition-colors"
            aria-label="Подробности за празника"
            type="button"
          >
            i
          </button>
          {isDesktopVisible && tooltipContent}
        </div>

        {/* Mobile: click-toggle icon (hidden on desktop) */}
        <div className="lg:hidden absolute top-0 right-0">
          <button
            onClick={(e) => {
              e.stopPropagation();
              e.preventDefault();
              setIsMobileVisible(!isMobileVisible);
            }}
            onPointerDown={(e) => {
              e.stopPropagation();
            }}
            className="text-[10px] bg-cinnamon/70 text-white rounded-full w-3.5 h-3.5 flex items-center justify-center font-bold"
            aria-label="Подробности за празника"
            type="button"
          >
            !
          </button>
          {isMobileVisible && tooltipContent}
        </div>
      </>
    );
  }
  ```

  **Critical:** The onPointerDown handler on the mobile button MUST call e.stopPropagation() to prevent the parent MonthGrid cell's pointer event handlers from firing (which would trigger drag selection).
  </action>
  <verify>
  - Verify DayTooltip.tsx has both `lg:hidden` and `hidden lg:block` sections
  - Verify `stopPropagation` is called on both onClick and onPointerDown
  - Run `npm run build` to verify no TypeScript/build errors
  </verify>
  <done>
  - Desktop: hover "i" icon shows tooltip (unchanged behavior)
  - Mobile: small "!" icon visible at top-right of holiday cells, click toggles tooltip
  - Tapping the "!" icon does NOT trigger drag selection
  </done>
</task>

</tasks>

<verification>
- `npm run build` completes without errors
- Legend.tsx has no "П" character in any swatch
- globals.css --color-vacation is a distinct color from --color-honey/--color-bridge
- DayTooltip.tsx has mobile-visible icon with click handler and stopPropagation
</verification>

<success_criteria>
1. Holiday legend swatch is plain colored square (no text)
2. Vacation color visually distinct from bridge color in both legend and calendar
3. Mobile holiday cells show "!" icon that toggles tooltip without triggering drag
4. Desktop tooltip behavior unchanged
5. Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/05.2-seo-improvements-and-layout-restructuring/05.2-07-SUMMARY.md`
</output>
