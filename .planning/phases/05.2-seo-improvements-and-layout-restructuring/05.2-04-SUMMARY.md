---
phase: 05.2-seo-improvements-and-layout-restructuring
plan: 04
subsystem: ui
tags: [calendar, tooltip, holiday-display, school-holidays, weekend-transfer, coffee-theme]

# Dependency graph
requires:
  - phase: 05.2-02
    provides: School holidays data layer with fetch logic and type definitions
  - phase: 05.2-03
    provides: Teal color tokens (bg-school-bg, text-teal) for school holiday display
  - phase: 05.1-02
    provides: Coffee theme tokens in MonthGrid (bg-cinnamon, bg-bridge-bg, etc.)
  - phase: 01-03
    provides: DayTooltip component for holiday information display
provides:
  - MonthGrid with fixed holiday colors (solid cinnamon matching legend)
  - Desktop-only tooltip behavior (no mobile interference with drag selection)
  - Weekend holiday transfer logic (weekend holidays display on Monday)
  - School holiday visual display with teal background color
  - New day type priority: Holiday > Vacation > School > Bridge > Weekend
  - Calendar dimension constraints (650px × 320px max per month)
  - Vacation + school holiday overlap indicator (small teal dot)
affects:
  - 05.2-06: FullYearCalendar will need to pass schoolHolidayDates prop to MonthGrid
  - Any future tooltip enhancements must preserve desktop-only behavior

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Desktop-only tooltip with hidden lg:block CSS pattern"
    - "Weekend holiday transfer: check Sat/Sun, display on Monday with substitute label"
    - "Day type priority cascade with displayAsHoliday boolean"
    - "Small dot indicator for overlapping day types (vacation + school)"

key-files:
  created: []
  modified:
    - components/DayTooltip.tsx: Desktop-only behavior, isSubstitute prop, Bulgarian date format
    - components/MonthGrid.tsx: Holiday color fix, school holidays, weekend transfer, dimensions

key-decisions:
  - "Tooltips desktop-only (hidden lg:block) to avoid interfering with mobile drag selection"
  - "Holiday cells use solid bg-cinnamon text-white (matching legend), not light bg-holiday-bg"
  - "Weekend holidays do NOT display on weekend day itself, only transfer to Monday"
  - "Monday substitute holidays show tooltip with '(почивен ден)' suffix"
  - "Day type priority reordered: Holiday > Vacation > School > Bridge > Weekend"
  - "Calendar cells bounded by max-w-[650px] max-h-[320px] per month"
  - "Vacation + school overlap shows vacation color with small teal dot indicator"

patterns-established:
  - "Weekend holiday transfer pattern: check 2 days back (Sat) and 1 day back (Sun) for Monday"
  - "displayAsHoliday boolean combines regular holidays and transferred holidays for rendering"
  - "isClickable excludes both regular and transferred holidays"
  - "School holiday prop is optional (?) to prevent build breaks when not passed yet"

# Metrics
duration: 2m 36s
completed: 2026-02-07
---

# Phase 5.2 Plan 04: Holiday Color Fixes, School Holidays, Weekend Transfer, Desktop-Only Tooltips

**Solid cinnamon holiday cells, desktop-only tooltips (no mobile interference), weekend holidays transfer to Monday with substitute label, school holidays display with teal background, new day type priority (Holiday > Vacation > School > Bridge > Weekend), calendar dimensions bounded**

## Performance

- **Duration:** 2m 36s
- **Started:** 2026-02-07T16:51:58Z
- **Completed:** 2026-02-07T16:54:34Z
- **Tasks:** 3 (1 tooltip refactor + 2 MonthGrid features)
- **Files modified:** 2

## Accomplishments

- Fixed holiday cell colors to use solid cinnamon background with white text (now matches legend exactly)
- Desktop-only tooltip behavior prevents interference with mobile drag selection (hidden lg:block wrapper)
- Weekend holiday transfer logic: weekend holidays display on Monday with "(почивен ден)" tooltip
- School holiday display with teal background (bg-school-bg text-teal)
- New day type priority order: Holiday > Vacation > School Holiday > Bridge > Weekend
- Calendar dimension constraints: max 650px width, 320px height per month
- Vacation + school holiday overlap indicator (small teal dot)

## Task Commits

Each task was committed atomically:

1. **Task 1: Update DayTooltip for desktop-only behavior** - `2e8ab73` (refactor)
   - Removed onClick handler (no mobile tooltip interaction)
   - Added hidden lg:block wrapper (CSS hides on mobile)
   - Added isSubstitute prop for weekend holiday transfer display
   - Made tooltip popup hoverable (onMouseEnter/onMouseLeave)
   - Reduced info button size to w-4 h-4 (smaller, less obtrusive)
   - Changed date format to Bulgarian style: d MMMM yyyy

2. **Task 2a: Update MonthGrid colors, dimensions, and tooltip rendering** - `40682d1` (feat)
   - Added DayTooltip import
   - Added 'relative' to day cell classes for tooltip positioning
   - Fixed holiday cell color: bg-cinnamon text-white (solid dark, matching legend)
   - Added tooltip rendering for holiday cells (desktop-only)
   - Added max dimensions: max-w-[650px] max-h-[320px] overflow-hidden
   - Removed debug console.log for December

3. **Task 2b: Add weekend transfer, school holidays, priority reorder, and indicators** - `a7b0c66` (feat)
   - Added schoolHolidayDates optional prop to MonthGridProps
   - Added schoolHolidaySet lookup for O(1) performance
   - Weekend holiday transfer logic: Monday shows substitute for Sat/Sun holidays
   - Weekend holidays do NOT show on weekend day itself (regular weekend display)
   - Transferred holidays show tooltip with "(почивен ден)" suffix
   - School holiday check: isSchoolHoliday from schoolHolidaySet
   - New day type priority: Holiday > Vacation > School > Bridge > Weekend
   - isClickable updated to exclude transferred holidays
   - School holiday + vacation overlap: small teal dot indicator
   - displayAsHoliday includes both regular and transferred holidays

## Files Created/Modified

- `components/DayTooltip.tsx` - Desktop-only tooltip with isSubstitute prop, no onClick handler, Bulgarian date format
- `components/MonthGrid.tsx` - Fixed holiday colors, school holiday display, weekend transfer logic, dimension constraints, teal dot indicator for vacation+school overlap

## Decisions Made

**Desktop-only tooltip pattern:**
- Used `hidden lg:block` CSS class on wrapper div instead of JavaScript media queries
- Removed onClick handler entirely - tooltips only activate on desktop hover (onMouseEnter/onMouseLeave)
- This prevents tooltip interaction from interfering with mobile drag selection (which uses pointer events)
- Rationale: Simpler, more performant, avoids JavaScript event conflicts

**Holiday color fix:**
- Changed from `bg-holiday-bg text-holiday` to `bg-cinnamon text-white font-semibold`
- This makes holiday cells use solid dark background with white text, matching the legend visual exactly
- Previous light background didn't match legend and was less visually distinct
- Rationale: Visual consistency between calendar cells and legend improves usability

**Weekend holiday transfer logic:**
- Weekend holidays (Sat/Sun) do NOT show holiday color on the weekend day itself
- Instead, the next Monday shows as a holiday with tooltip displaying holiday name + "(почивен ден)"
- Logic: if Monday and not a regular holiday, check 2 days back (Sat) and 1 day back (Sun) for holidays
- Transferred holidays are non-clickable (excluded from vacation selection)
- Rationale: Reflects real-world Bulgarian practice where weekend holidays are observed on Monday

**Day type priority reorder:**
- New priority: Holiday > Vacation > School Holiday > Bridge > Weekend
- Previous: Holiday > Bridge > Vacation > Weekend
- Vacation now takes priority over school holidays (user's personal vacation more important)
- When vacation and school holiday overlap, show vacation color with small teal dot indicator
- Rationale: User's personal plans take precedence over informational school dates

**School holiday prop is optional:**
- `schoolHolidayDates?: string[]` with default empty array in MonthGrid
- This prevents TypeScript errors when FullYearCalendar doesn't pass the prop yet (will be added in Plan 06)
- Rationale: Incremental rollout - MonthGrid ready for school holidays before parent component wired

**Calendar dimension constraints:**
- Added `max-w-[650px] max-h-[320px] overflow-hidden` to month container
- Prevents calendar cells from growing too large on wide screens
- Maintains compact appearance suitable for 12-month vertical scroll layout
- Rationale: User feedback that calendar took up too much horizontal space

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None - all tasks completed without problems.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

**Ready for Plan 05.2-05 (VacationSummary Relocation):**
- MonthGrid calendar dimension constraints complete
- All calendar rendering logic ready for VacationSummary to be moved above calendar

**Ready for Plan 05.2-06 (School Holidays Sidebar):**
- MonthGrid already accepts schoolHolidayDates prop (optional)
- School holiday visual display (teal background) is working
- Vacation + school overlap indicator (teal dot) is working
- FullYearCalendar just needs to expand school holiday ranges into individual dates and pass prop

**Note:** Weekend holiday transfer and school holiday display are implemented but NOT visually active until Plan 05.2-06 wires the data through FullYearCalendar. The MonthGrid logic is complete and tested.

---
*Phase: 05.2-seo-improvements-and-layout-restructuring*
*Completed: 2026-02-07*
